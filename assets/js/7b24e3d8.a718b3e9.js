"use strict";(globalThis.webpackChunkdocusaurus_site=globalThis.webpackChunkdocusaurus_site||[]).push([[3778],{28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>o});var t=a(96540);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},45458:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Clipboard21-8d851887072ff59a7d848fb97d94ba0e.jpg"},49343:e=>{e.exports=JSON.parse('{"permalink":"/auto-deployment-vm-with-vsts-agent-for-pool","editUrl":"https://github.com/RogalaPiotr/JustCloudBlog/tree/main/website/blog/2018-05-27-auto-deployment-vm-with-vsts-agent-for-pool/index.md","source":"@site/blog/2018-05-27-auto-deployment-vm-with-vsts-agent-for-pool/index.md","title":"Auto deployment VM with VSTS agent for pool","description":"Szablon ARM automatyzuje stworzenie maszyny w Azure i instalacj\u0119 agenta Azure DevOps (VSTS). Szybki deployment, konfiguracja agenta i integracja z pul\u0105. \u0141atwo.","date":"2018-05-27T00:00:00.000Z","tags":[{"inline":true,"label":"arm","permalink":"/tags/arm"},{"inline":true,"label":"automation","permalink":"/tags/automation"},{"inline":true,"label":"azure","permalink":"/tags/azure"},{"inline":true,"label":"deployment","permalink":"/tags/deployment"},{"inline":true,"label":"json","permalink":"/tags/json"},{"inline":true,"label":"microsoft","permalink":"/tags/microsoft"},{"inline":true,"label":"vsts","permalink":"/tags/vsts"},{"inline":true,"label":"ado","permalink":"/tags/ado"},{"inline":true,"label":"vm","permalink":"/tags/vm"},{"inline":true,"label":"template","permalink":"/tags/template"}],"readingTime":6.77,"hasTruncateMarker":true,"authors":[{"name":"Piotr Rogala","title":"MVP Azure & owner JustCloud.pl","url":"https://github.com/RogalaPiotr","page":{"permalink":"/authors/progala"},"socials":{"x":"https://x.com/RogalaPiotr","linkedin":"https://www.linkedin.com/in/rogalapiotr/","github":"https://github.com/RogalaPiotr","newsletter":"https://subscribepage.io/wroclaw-newsletter-workshops"},"imageURL":"https://blog.justcloud.pl/img/author.jpg","key":"progala"}],"frontMatter":{"authors":["progala"],"date":"2018-05-27","description":"Szablon ARM automatyzuje stworzenie maszyny w Azure i instalacj\u0119 agenta Azure DevOps (VSTS). Szybki deployment, konfiguracja agenta i integracja z pul\u0105. \u0141atwo.","hide_table_of_contents":true,"keywords":["justcloud","ado","azure","azure devops","devops","agent","pipelines","deployment","arm","vm"],"slug":"auto-deployment-vm-with-vsts-agent-for-pool","tags":["arm","automation","azure","deployment","json","microsoft","vsts","ado","vm","template"],"title":"Auto deployment VM with VSTS agent for pool"},"unlisted":false,"prevItem":{"title":"Sk\u0105d uczy\u0107 si\u0119 o Microsoft Azure?","permalink":"/skad-uczyc-sie-o-microsoft-azure"},"nextItem":{"title":"Google Cloud Platform deployment VM z Ubuntu","permalink":"/google-cloud-platform-deployment-vm-z-ubuntu"}}')},55357:(e,n,a)=>{a.d(n,{A:()=>t});const t=a.p+"assets/images/Clipboard22-1b82d9e149275cd7f3aa92dc67e94dc2.jpg"},74899:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>c});var t=a(49343),s=a(74848),r=a(28453);const i={authors:["progala"],date:"2018-05-27",description:"Szablon ARM automatyzuje stworzenie maszyny w Azure i instalacj\u0119 agenta Azure DevOps (VSTS). Szybki deployment, konfiguracja agenta i integracja z pul\u0105. \u0141atwo.",hide_table_of_contents:!0,keywords:["justcloud","ado","azure","azure devops","devops","agent","pipelines","deployment","arm","vm"],slug:"auto-deployment-vm-with-vsts-agent-for-pool",tags:["arm","automation","azure","deployment","json","microsoft","vsts","ado","vm","template"],title:"Auto deployment VM with VSTS agent for pool"},o=void 0,l={authorsImageUrls:[void 0]},c=[{value:"<strong>GitHub</strong> https://github.com/RogalaPiotr/JustCloudPublic/tree/master/simple-vm-with-installation-vsts-agent",id:"github-httpsgithubcomrogalapiotrjustcloudpublictreemastersimple-vm-with-installation-vsts-agent",level:5},{value:"Opis szablonu",id:"opis-szablonu",level:2},{value:"Sekcja Parameters",id:"sekcja-parameters",level:2},{value:"Sekcja Variables",id:"sekcja-variables",level:2},{value:"Sekcja Resources",id:"sekcja-resources",level:2},{value:"<strong>Sekcja Outputs</strong>",id:"sekcja-outputs",level:2},{value:"Szablon",id:"szablon",level:2},{value:"Przyk\u0142ad",id:"przyk\u0142ad",level:2},{value:"Aby wykona\u0107 deployment nale\u017cy utworzy\u0107 Resource Group\u0119",id:"aby-wykona\u0107-deployment-nale\u017cy-utworzy\u0107-resource-group\u0119",level:3},{value:"Wykonanie deploymentu",id:"wykonanie-deploymentu",level:3},{value:"Efekt w portalu po deploymencie",id:"efekt-w-portalu-po-deploymencie",level:3},{value:"Widok puli agent\xf3w w VSTS",id:"widok-puli-agent\xf3w-w-vsts",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Wszyscy kt\xf3rzy robi\u0105 depyolemnty z VSTS spotykaj\u0105 si\u0119 z sytuacj\u0105, kiedy standardowe 240min si\u0119 ko\u0144czy i trzeba stworzy\u0107 sobie tak\u0105 maszyn\u0119. Sam robi\u0142em tak\u0105 maszyn\u0119 par\u0119 razy i kiedy zn\xf3w pojawi\u0142a si\u0119 ta konieczno\u015b\u0107 postanowi\u0142em stworzy\u0107 automatyczny deployment kt\xf3ry nam stworzy z JSON'a ca\u0142a maszynk\u0119 i podepnie j\u0105 do Agent pool w VSTS."}),"\n",(0,s.jsx)(n.p,{children:"Mia\u0142em par\u0119 pomys\u0142\xf3w, aby zrobi\u0107 bardzo uniwersalny template kt\xf3ry nie tylko przyda si\u0119 wam, ale r\xf3wnie\u017c mi w przysz\u0142o\u015bci do budowania innych szablon\xf3w. Tak\u017ce w skr\xf3cie opisz\u0119 ciekawostki kt\xf3re zastosowa\u0142em szablonie, kt\xf3ry znajdziecie na moim GitHubie."}),"\n",(0,s.jsxs)(n.h5,{id:"github-httpsgithubcomrogalapiotrjustcloudpublictreemastersimple-vm-with-installation-vsts-agent",children:[(0,s.jsx)(n.strong,{children:"GitHub"})," ",(0,s.jsx)(n.a,{href:"https://github.com/RogalaPiotr/JustCloudPublic/tree/master/simple-vm-with-installation-vsts-agent",children:"https://github.com/RogalaPiotr/JustCloudPublic/tree/master/simple-vm-with-installation-vsts-agent"})]}),"\n",(0,s.jsx)(n.p,{children:"Za\u0142o\u017cenie dotycz\u0105ce szablonu: chcia\u0142bym doda\u0107 informacj\u0119, gdzie wa\u017cnym jest zwr\xf3cenie uwagi, \u017ce maszyna ma by\u0107 odizolowana od naszej sieci wewn\u0119trznej, dlatego szablon jest infrastruktura stand alone, aby by\u0142o bezpiecznie i w razie czego mo\u017cna j\u0105 usun\u0105 lub powo\u0142a\u0107 wi\u0119cej agent\xf3w do deployment\xf3w."}),"\n",(0,s.jsx)(n.h2,{id:"opis-szablonu",children:"Opis szablonu"}),"\n",(0,s.jsx)(n.h2,{id:"sekcja-parameters",children:"Sekcja Parameters"}),"\n",(0,s.jsx)(n.p,{children:"w tej sekcji podajemy dane kt\xf3re przydadz\u0105 nam si\u0119 do deplymentu i automatycznego pod\u0142\u0105czenia do VSTS'a."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"adminUsername"}),", ",(0,s.jsx)(n.strong,{children:"adminPassword"})," - lokalny u\u017cytkownik i has\u0142o,"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"dnsLabelPrefix"})," - zostanie automatycznie wygenerowany podczas deployment\u2019u, wi\u0119c nie ma konieczno\u015bci go zmienia\u0107,"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"vmName"})," - nazwa naszej maszyny oraz na podstawie tej nazwy zostan\u0105 nazwane wszystkie nasze resource jest: VNET, NSG, Storage..."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"urlvsts"})," - adres do naszego projektu VSTS, np. ",(0,s.jsx)(n.a,{href:"https://project1.visualstudio.com",children:"https://project1.visualstudio.com"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"auth"})," - rodzaj po\u015bwiadczenia - wybrany domy\u015blnie PAT,"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"token"})," - token security kt\xf3ry umo\u017cliwi nam pod\u0142\u0105czenie si\u0119 do projektu. Wi\u0119cej informacji jak stworzy\u0107 Security Token poni\u017cej:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/vsts/build-release/actions/agents/v2-windows?view=vsts",children:"Dokumentacja agenta VSTS"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"pool"})," - nazwa puli, do kt\xf3rej zostanie dodana maszyna w VSTS'ie - ustawiony jest na default"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"AccessIPNSG"})," - adres, kt\xf3ry tutaj podacie zostanie dodany do NSG i tylko z tego adresu dostaniecie si\u0119 po RDP do maszyny,"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Tag"})," - tagi mog\u0105 ulec waszej modyfikacji ustawione s\u0105 na Project: VSTSAgent."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"sekcja-variables",children:"Sekcja Variables"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"vmsize"}),' - ustawiony na "Standard_B1s". To tani rozmiar wystarczaj\u0105cy na maszyn\u0119 deploymentow\u0105. Sprawd\u017a, czy mo\u017cesz deployowa\u0107 t\u0119 maszyn\u0119 w swojej subskrypcji; w przeciwnym razie zg\u0142o\u015b request do supportu Microsoft.']}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"urldonwloadagent"})," - link do pobrania paczki agenta VSTS. W razie zmiany wersji zaktualizuj link."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"filescriptURI"})," - skrypt automatyzuj\u0105cy pobranie i instalacj\u0119 agenta: ",(0,s.jsx)(n.a,{href:"https://raw.githubusercontent.com/RogalaPiotr/JustCloudPublic/master/simple-vm-with-installation-vsts-agent/vstsagent.ps1",children:"vstsagent.ps1 na GitHubie"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"filescriptURISplit"}),' - funkcja, kt\xf3ra rozbija powy\u017cszy URL na cz\u0119\u015bci wed\u0142ug znaku "/" i tworzy tablic\u0119.']}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["wi\u0119cej informacji: ",(0,s.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-template-functions",children:"Funkcje ARM Templates"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"filescriptName"})," - nazwa skryptu u\u017cywanego w CustomScriptExtension uzyskiwana z powy\u017cszego split."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"agentname"})," - nazwa agenta dodawanego do puli; domy\u015blnie oparta na nazwie maszyny."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"sekcja-resources",children:"Sekcja Resources"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"type: Microsoft.Network/networkSecurityGroups"})," - NSG z dost\u0119pem RDP tylko z adresu IP, kt\xf3ry podamy w parametrze AccessIPNSG."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"type: Microsoft.Network/publicIPAddresses"})," - publiczny adres dla VM, umo\u017cliwiaj\u0105cy po\u0142\u0105czenie z zewn\u0105trz."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"type: Microsoft.Network/virtualNetworks"})," - VNet."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"type: Microsoft.Compute/virtualMachines"})," - tworzenie maszyny wirtualnej z Windows i Managed Disk."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"type: Microsoft.Compute/virtualMachines/extensions"}),' - instalacja agenta VSTS oparta na skrypcie z GitHuba (vstsagent.ps1); pe\u0142na komenda znajduje si\u0119 w polu "commandToExecute".']}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"type: Microsoft.DevTestLab/schedules"})," - dzi\u0119ki temu nasza maszynie b\u0119dzie wy\u0142\u0105czana codziennie o 18:00 zona: W. Europe Standard Time - ten feature dzia\u0142a tylko kiedy maszyna jest w\u0142\u0105czona pozwoli to nam zapomnie\u0107 o wy\u0142\u0105czaniu, a mimo wszystko nie b\u0119dziemy traci\u0107 pieni\u0119dzy za jej bezczynno\u015b\u0107."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"sekcja-outputs",children:(0,s.jsx)(n.strong,{children:"Sekcja Outputs"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PublicDNS"})," - po wykonaniu deployment\u2019u wy\u015bwietli nam publiczny adres DNS dla VM,"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hostname"})," - wy\u015bwietli nazw\u0119 maszyny, kt\xf3r\u0105 wprowadzili\u015bmy w parametrach,"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"VSTSAgentName"})," - wy\u015bwietli nazw\u0119 agenta jaka b\u0119dzie widoczna w VSTS,"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"VSTSProjectName"})," - wy\u015bwietli nazw\u0119 projektu VSTS jaki zosta\u0142 wprowadzony,"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ScriptURI"})," - wy\u015bwietli \u017ar\xf3d\u0142o z jakiego zosta\u0142 pobrany skrypt do instalacji Agenta,"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"AccessRDPFrom"})," - wy\u015bwietli adres IP kt\xf3ry zosta\u0142 dodany do NSG, aby mia\u0142 dost\u0119p do RDP"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"szablon",children:"Szablon"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",\n  "contentVersion": "1.0.0.0",\n  "parameters": {\n    "adminUsername": {\n      "type": "string",\n      "metadata": {\n        "description": "Username for the Virtual Machine."\n      }\n    },\n    "adminPassword": {\n      "type": "securestring",\n      "metadata": {\n        "description": "Password for the Virtual Machine."\n      }\n    },\n    "dnsLabelPrefix": {\n      "type": "string",\n      "defaultValue": "[concat(\'x\', uniqueString(resourceGroup().id))]",\n      "metadata": {\n        "description": "Unique DNS Name for the Public IP used to access the Virtual Machine."\n      }\n    },\n    "vmName": {\n      "type": "string",\n      "metadata": {\n        "description": "Unique DNS Name for the Public IP used to access the Virtual Machine."\n      }\n    },\n    "urlvsts": {\n      "type": "string",\n      "metadata": {\n        "description": "URL for your VSTS Project ex. https://project1.visualstudio.com."\n      }\n    },\n    "auth": {\n      "type": "string",\n      "defaultValue": "pat",\n      "metadata": {\n        "description": "Unique DNS Name for the Public IP used to access the Virtual Machine."\n      }\n    },\n    "token": {\n      "type": "securestring",\n      "metadata": {\n        "description": "Security token for VSTS project."\n      }\n    },\n    "pool": {\n      "type": "string",\n      "metadata": {\n        "description": "Pool name in VSTS - Default is a main."\n      }\n    },\n    "AccessIPNSG": {\n      "type": "string",\n      "metadata": {\n        "description": "Your public IP it will added for NSG for connection via RDP."\n      }\n    },\n    "numberagents": {\n      "type": "int",\n      "metadata": {\n        "description": "Numbers of agents for installation"\n      }\n    },\n    "tag": {\n      "type": "string",\n      "metadata": {\n          "description": "Tag Values"\n      }\n  }\n},\n  "variables": {\n    "storageAccountName": "[concat(\'stor\', uniquestring(resourceGroup().id))]",\n    "windowsOSVersion": "2019-Datacenter",\n    "vmsize": "Standard_B2ms",\n    "publicIPAddressName": "[concat(parameters(\'vmName\'), \'-pip\')]",\n    "virtualNetworkName": "[concat(parameters(\'vmName\'), \'-vnet\')]",\n    "NSGname": "[concat(parameters(\'vmName\'), \'-nsg\')]",\n    "nicName": "[concat(parameters(\'vmName\'), \'-nic\')]",\n    "subnetName": "[concat(parameters(\'vmName\'), \'-subnet\')]",\n    "addressPrefix": "10.0.0.0/16",\n    "subnetPrefix": "10.0.0.0/24",\n    "subnetRef": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'virtualNetworkName\'), variables(\'subnetName\'))]",\n    "urldonwloadagent": "https://vstsagentpackage.azureedge.net/agent/2.155.1/vsts-agent-win-x64-2.155.1.zip",\n    "filescriptURI": "https://raw.githubusercontent.com/RogalaPiotr/JustCloudPublic/master/simple-vm-with-installation-vsts-agent/vstsagent.ps1",\n    "filescriptURISplit": "[split(variables(\'filescriptURI\'), \'/\')]",\n    "filescriptName": "[last(variables(\'filescriptURISplit\'))]",\n    "agentname": "[parameters(\'vmName\')]"\n  },\n  "resources": [\n    {\n      "type": "Microsoft.Storage/storageAccounts",\n      "name": "[variables(\'storageAccountName\')]",\n      "apiVersion": "2015-06-15",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "properties": {\n        "accountType": "Standard_LRS"\n      }\n    },\n    {\n      "type": "Microsoft.Network/networkSecurityGroups",\n      "name": "[variables(\'NSGName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "apiVersion": "2018-03-01",\n      "properties": {\n        "securityRules": [\n          {\n            "name": "RDP",\n            "properties": {\n              "description": "Allow IP for RDP",\n              "protocol": "TCP",\n              "sourcePortRange": "*",\n              "destinationPortRange": "3389",\n              "sourceAddressPrefix": "[parameters(\'AccessIPNSG\')]",\n              "destinationAddressPrefix": "*",\n              "access": "Allow",\n              "priority": 100,\n              "direction": "Inbound"\n            }\n          }\n        ]\n      }\n    },\n    {\n      "apiVersion": "2016-03-30",\n      "type": "Microsoft.Network/publicIPAddresses",\n      "name": "[variables(\'publicIPAddressName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "properties": {\n        "publicIPAllocationMethod": "Dynamic",\n        "dnsSettings": {\n          "domainNameLabel": "[parameters(\'dnsLabelPrefix\')]"\n        }\n      }\n    },\n    {\n      "apiVersion": "2016-03-30",\n      "type": "Microsoft.Network/virtualNetworks",\n      "name": "[variables(\'virtualNetworkName\')]",\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Network/networkSecurityGroups/\', variables(\'NSGName\'))]"\n      ],\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "properties": {\n        "addressSpace": {\n          "addressPrefixes": [\n            "[variables(\'addressPrefix\')]"\n          ]\n        },\n        "subnets": [\n          {\n            "name": "[variables(\'subnetName\')]",\n            "properties": {\n              "addressPrefix": "[variables(\'subnetPrefix\')]",\n              "networkSecurityGroup": {\n                "id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\',variables(\'NSGName\'))]"\n            }\n            }\n          }\n        ]\n      }\n    },\n    {\n      "apiVersion": "2016-03-30",\n      "type": "Microsoft.Network/networkInterfaces",\n      "name": "[variables(\'nicName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Network/publicIPAddresses/\', variables(\'publicIPAddressName\'))]",\n        "[resourceId(\'Microsoft.Network/virtualNetworks/\', variables(\'virtualNetworkName\'))]"\n      ],\n      "properties": {\n        "ipConfigurations": [\n          {\n            "name": "ipconfig1",\n            "properties": {\n              "privateIPAllocationMethod": "Dynamic",\n              "publicIPAddress": {\n                "id": "[resourceId(\'Microsoft.Network/publicIPAddresses\',variables(\'publicIPAddressName\'))]"\n              },\n              "subnet": {\n                "id": "[variables(\'subnetRef\')]"\n              }\n            }\n          }\n        ]\n      }\n    },\n    {\n      "apiVersion": "2016-04-30-preview",\n      "type": "Microsoft.Compute/virtualMachines",\n      "name": "[parameters(\'vmName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Network/networkInterfaces/\', variables(\'nicName\'))]",\n        "[concat(\'Microsoft.Storage/storageAccounts/\', variables(\'storageAccountName\'))]"\n      ],\n      "properties": {\n        "licenseType": "Windows_Server",\n        "hardwareProfile": {\n          "vmSize": "[variables(\'vmsize\')]"\n        },\n        "osProfile": {\n          "computerName": "[parameters(\'vmName\')]",\n          "adminUsername": "[parameters(\'adminUsername\')]",\n          "adminPassword": "[parameters(\'adminPassword\')]"\n        },\n        "storageProfile": {\n          "imageReference": {\n            "publisher": "MicrosoftWindowsServer",\n            "offer": "WindowsServer",\n            "sku": "[variables(\'windowsOSVersion\')]",\n            "version": "latest"\n          },\n          "osDisk": {\n            "name": "[concat(parameters(\'vmName\'),\'-os\')]",\n            "vhd": {\n              "uri": "[concat(\'http://\',variables(\'storageAccountName\'),\'.blob.core.windows.net/vhds/\',parameters(\'vmName\'),\'-vm-os.vhd\')]"\n            },\n            "caching": "ReadWrite",\n            "createOption": "FromImage"\n          }\n        },\n        "networkProfile": {\n          "networkInterfaces": [\n            {\n              "id": "[resourceId(\'Microsoft.Network/networkInterfaces\',variables(\'nicName\'))]"\n            }\n          ]\n        }\n      },\n      "resources": [\n        {\n          "name": "[concat(parameters(\'vmName\'),\'/AzureDevOpsAgentInstall\')]",\n          "type": "Microsoft.Compute/virtualMachines/extensions",\n          "location": "[resourceGroup().location]",\n          "tags": {\n            "Project": "[parameters(\'tag\')]"\n          },\n          "dependsOn": [\n            "[concat(\'Microsoft.Compute/virtualMachines/\', parameters(\'vmName\'))]"\n          ],\n          "apiVersion": "2015-06-15",\n          "properties": {\n            "publisher": "Microsoft.Compute",\n            "type": "CustomScriptExtension",\n            "typeHandlerVersion": "1.9",\n            "autoUpgradeMinorVersion": true,\n            "settings": {\n              "fileUris": [\n                "[variables(\'filescriptURI\')]"\n                ]\n            },\n            "protectedSettings": {\n              "commandToExecute": "[concat(\'powershell -ExecutionPolicy Unrestricted -File \',variables(\'filescriptName\'),\' -url \',variables(\'urldonwloadagent\'),\' -urlvsts \',parameters(\'urlvsts\'),\' -auth \',parameters(\'auth\'),\' -token \',parameters(\'token\'),\' -pool \',parameters(\'pool\'),\' -agentname \',variables(\'agentname\'), \' -numberagents \',parameters(\'numberagents\'))]"\n            }\n          }\n        }\n      ]\n    },\n    {\n      "apiVersion": "2016-05-15",\n      "type": "Microsoft.DevTestLab/schedules",\n      "name": "[concat(\'shutdown-computevm-\', parameters(\'vmName\'))]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Compute/virtualMachines/\', parameters(\'vmName\'))]"\n      ],\n      "properties": {\n        "status":"Enabled",\n        "timeZoneId":"W. Europe Standard Time",\n        "taskType":"ComputeVmShutdownTask",\n        "notificationSettings":{\n          "status":"Disabled",\n          "timeInMinutes":15,\n          "webhookUrl":null\n        },\n        "targetResourceId":"[resourceId(\'Microsoft.Compute/virtualMachines\', parameters(\'vmName\'))]",\n        "dailyRecurrence":{\n          "time":"1800"\n        }\n      }\n    }\n  ],\n  "outputs": {\n    "PublicDNS": {\n      "type" : "string",\n      "value": "[reference(variables(\'publicIPAddressName\')).dnsSettings.fqdn]"\n    },\n    "HostName": {\n      "type" : "string",\n      "value": "[parameters(\'vmName\')]"\n    },\n    "VSTSAgentName": {\n      "type" : "string",\n      "value": "[variables(\'agentname\')]"\n    },  \n    "VSTSProjectName": {\n      "type" : "string",\n      "value": "[parameters(\'urlvsts\')]"\n    },  \n    "ScritpURI": {\n      "type" : "string",\n      "value": "[variables(\'filescriptURI\')]"\n    },\n    "AccessRDPFrom": {\n      "type" : "string",\n      "value": "[parameters(\'accessIPNSG\')]"\n    }\n  }\n}\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"przyk\u0142ad",children:"Przyk\u0142ad"}),"\n",(0,s.jsx)(n.h3,{id:"aby-wykona\u0107-deployment-nale\u017cy-utworzy\u0107-resource-group\u0119",children:"Aby wykona\u0107 deployment nale\u017cy utworzy\u0107 Resource Group\u0119"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"New-AzureRMResourceGroup -Name VSTS -Location westeurope"})}),"\n",(0,s.jsx)(n.h3,{id:"wykonanie-deploymentu",children:"Wykonanie deploymentu"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'New-AzureRMResourceGroupDeployment -ResourceGroupName VSTS -TemplateURI "https://raw.githubusercontent.com/RogalaPiotr/JustCloudPublic/master/simple-vm-with-installation-vsts-agent/azuredeploy.json" -Verbose'})}),"\n",(0,s.jsx)(n.h3,{id:"efekt-w-portalu-po-deploymencie",children:"Efekt w portalu po deploymencie"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Zrzut ekranu - efekt w portalu",src:a(45458).A+"",width:"1360",height:"637"})}),"\n",(0,s.jsx)(n.h3,{id:"widok-puli-agent\xf3w-w-vsts",children:"Widok puli agent\xf3w w VSTS"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Zrzut ekranu - pula agent\xf3w",src:a(55357).A+"",width:"925",height:"335"})}),"\n",(0,s.jsx)(n.p,{children:"Maszyna jest gotowa do deployment\xf3w, je\u015bli potrzebujesz wi\u0119cej maszyn mo\u017cesz bez oporu deployowa\u0107 wi\u0119ksz\u0105 ilo\u015b\u0107 \ud83d\ude0a"}),"\n",(0,s.jsx)(n.p,{children:"Czas deplymentu to: 15 minutes 46 seconds."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);