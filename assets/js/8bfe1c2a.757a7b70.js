"use strict";(self.webpackChunkjustcloudblog=self.webpackChunkjustcloudblog||[]).push([[8311],{3905:function(e,a,t){t.d(a,{Zo:function(){return u},kt:function(){return k}});var o=t(7294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);a&&(o=o.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,o,n=function(e,a){if(null==e)return{};var t,o,n={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var p=o.createContext({}),s=function(e){var a=o.useContext(p),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},u=function(e){var a=s(e.components);return o.createElement(p.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return o.createElement(o.Fragment,{},a)}},z=o.forwardRef((function(e,a){var t=e.components,n=e.mdxType,r=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),z=s(t),k=n,m=z["".concat(p,".").concat(k)]||z[k]||c[k]||r;return t?o.createElement(m,i(i({ref:a},u),{},{components:t})):o.createElement(m,i({ref:a},u))}));function k(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var r=t.length,i=new Array(r);i[0]=z;var l={};for(var p in a)hasOwnProperty.call(a,p)&&(l[p]=a[p]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var s=2;s<r;s++)i[s]=t[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}z.displayName="MDXCreateElement"},8481:function(e,a,t){t.r(a),t.d(a,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},assets:function(){return u},toc:function(){return c},default:function(){return k}});var o=t(7462),n=t(3366),r=(t(7294),t(3905)),i=["components"],l={slug:"tags-in-azure",title:"Przyspieszenie pracy nad tagowaniem zasob\xf3w za pomoc\u0105 PowerShell - Tag raport Microsoft Azure",description:"Zastanawiasz si\u0119 jak tagowa\u0107 zasoby w Azure? W tym artykule dok\u0142adnie opisuje jak to zrobi\u0107 dla ma\u0142ych i du\u017cych \u015brodowisk w Auzre.",date:"2021-06-03",authors:["progala"],tags:["azutomation","csv","microsoft azure","raport","report","tag","tagging","tags"],keywords:["justcloud","powershell","api","tagowanie","tags","automatyzacja","automation","csv","azure","microsoft azure"]},p=void 0,s={permalink:"/tags-in-azure",source:"@site/blog/2021-06-03-tags-in-azure/index.md",title:"Przyspieszenie pracy nad tagowaniem zasob\xf3w za pomoc\u0105 PowerShell - Tag raport Microsoft Azure",description:"Zastanawiasz si\u0119 jak tagowa\u0107 zasoby w Azure? W tym artykule dok\u0142adnie opisuje jak to zrobi\u0107 dla ma\u0142ych i du\u017cych \u015brodowisk w Auzre.",date:"2021-06-03T00:00:00.000Z",formattedDate:"June 3, 2021",tags:[{label:"azutomation",permalink:"/tags/azutomation"},{label:"csv",permalink:"/tags/csv"},{label:"microsoft azure",permalink:"/tags/microsoft-azure"},{label:"raport",permalink:"/tags/raport"},{label:"report",permalink:"/tags/report"},{label:"tag",permalink:"/tags/tag"},{label:"tagging",permalink:"/tags/tagging"},{label:"tags",permalink:"/tags/tags"}],readingTime:2.995,truncated:!0,authors:[{name:"Piotr Rogala",title:"MVP Azure & owner JustCloud.pl",url:"https://github.com/RogalaPiotr",imageURL:"https://avatars.githubusercontent.com/u/31566956?v=4",key:"progala"}],prevItem:{title:"Nowa ods\u0142ona",permalink:"/welcome"},nextItem:{title:"Wys\u0142anie \u017c\u0105dania API z PowerShell do Azure DevOps",permalink:"/wyslanie-zadania-api-z-powershell-do-azure-devops"}},u={authorsImageUrls:[void 0]},c=[],z={toc:c};function k(e){var a=e.components,t=(0,n.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},z,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Kiedy\u015b przygotowa\u0142em ten skrypt \u017ceby szybko m\xf3c otagowa\u0107 wiele zasob\xf3w wdro\u017conych na platformie Microsoft Azure. Jest wiele mo\u017cliwo\u015bci jak to zrobi\u0107 szybko, prosto, ale stara\u0142em si\u0119 zrobi\u0107 uniwersalne rozwi\u0105zanie b\u0119d\u0105ce \u0142atwe oraz bezpieczne w u\u017cyciu. Dlatego postanowi\u0142em zrobi\u0107 jeden skrypt, kt\xf3ry generuje nam wszystkie zasoby do pliku CSV. A drugi skrypt na podstawie pliku CSV b\u0119dzie pobiera\u0142 z niego dane zasob\xf3w i nadpisywa\u0142 je na platformie."),(0,r.kt)("p",null,"Skrypty s\u0105 dost\u0119pne na GitHub:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/RogalaPiotr/JustCloudPublic/tree/master/azure-tags-report"},"https://github.com/RogalaPiotr/JustCloudPublic/tree/master/azure-tags-report"))),(0,r.kt)("p",null,"Opis skrypt\xf3w:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GetAllTags.ps1- generuje dwa pliki CSV. Jeden plik dla Resource Group, a drugi plik dla Resources. Jest to istotne poniewa\u017c mamy oddzielone grupy i mo\u017cemy inaczej tagowa\u0107 grupy od zasob\xf3w bez szukania typ\xf3w zasob\xf3w."),(0,r.kt)("li",{parentName:"ul"},"SetTagsResourceGroups.ps1 - skrypt, kt\xf3ry pobiera dane z pliku CSV gdzie jest spis Resource Group z tagami do wdro\u017cenia."),(0,r.kt)("li",{parentName:"ul"},"SetTagsResources.ps1- skrypt, kt\xf3ry pobiera dane z pliku CSV gdzie zapisane mamy zasoby z tagami do wdro\u017cenia.")),(0,r.kt)("p",null,"Taki podzia\u0142 daje nam:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Zapis stanu obecnego tag\xf3w zapisanych do pliku CSV. Jest to raport tag\xf3w czyli obecny stan wdro\u017cony tag\xf3w."),(0,r.kt)("li",{parentName:"ol"},"Podzia\u0142 na grupy i zasoby."),(0,r.kt)("li",{parentName:"ol"},"Mo\u017cliwo\u015b\u0107 poprawiania tag\xf3w tylko na zasobach lub tylko na grupach zasob\xf3w.")),(0,r.kt)("p",null,"Jak dzia\u0142aj\u0105 skrypty?"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"GetAllTags",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Zapis do pliku odbywa si\u0119 automatycznie do lokalizacji gdzie wykonujemy skrypt lub mo\u017cemy u\u017cy\u0107 opcji -path gdzie maj\u0105 by\u0107 zapisane pliki."),(0,r.kt)("li",{parentName:"ol"},"Nazwa pliku zawiera dat\u0119, je\u015bli plik istnieje zostanie on nadpisany."),(0,r.kt)("li",{parentName:"ol"},"Skrypt sprawdza czy jeste\u015b zalogowany do Azure. Podczas wykonywania skryptu mo\u017cesz poda\u0107 parametr -tenantId, aby mie\u0107\xa0pewno\u015b\u0107\xa0\u017ce logujesz si\u0119\xa0do odpowiedniego Azure Directory i -subId w celu wybrania subskrypcji."))),(0,r.kt)("li",{parentName:"ol"},"SetTagsResourceGroups oraz SetTagsResources",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Import danych z plik\xf3w odbywa si\u0119 automatycznie na podstawie konwencji nazewniczej wygenerowanego wcze\u015bniej pliku. Skrypt importuje najnowszy plik CSV we wskazanym katalogu. Istnieje podanie \u015bcie\u017cki poprzez parametr -path."),(0,r.kt)("li",{parentName:"ol"},"Tagi powinny by\u0107 oddzielone mi\u0119dzy sob\u0105 przecinkami."),(0,r.kt)("li",{parentName:"ol"},"Tagi zapisane w pliku CSV dzia\u0142aj\u0105 na zasadzie par \u201cKey:Value\u201d w osobnych kolumnach."),(0,r.kt)("li",{parentName:"ol"},"Skrypt pobiera wszystkie elementy z pliku CSV. Nast\u0119pnie skrypt usuwa tagi w Microsoft Azure nast\u0119pnie wprowadzony z pliku CSV."),(0,r.kt)("li",{parentName:"ol"},"Je\u015bli nie chcemy danego zasobu rusza\u0107, wystarczy go usun\u0105\u0107 z pliku CSV."),(0,r.kt)("li",{parentName:"ol"},"Skrypt dzia\u0142a w trybie parallel co pozwala na szybsze wprowadzanie zmian. Throttle dla zapisu tag\xf3w wynosi 5, pami\u0119taj, \u017ce jest to optymalna warto\u015b\u0107."),(0,r.kt)("li",{parentName:"ol"},"Skrypt sprawdza czy jeste\u015b zalogowany do Azure. Podczas wykonywania skryptu mo\u017cesz poda\u0107 parametr -tenantId."),(0,r.kt)("li",{parentName:"ol"},"Je\u015bli chcesz wyczy\u015bci\u0107 tagi na zasobach wystarczy \u017ce zostawisz pust\u0105 kom\xf3rk\u0119\xa0lub wpiszesz \u201cempty\u201d."),(0,r.kt)("li",{parentName:"ol"},"Wprowadzanie tag\xf3w mo\u017cemy testowa\u0107\xa0wprowadzaj\u0105c w pliku CSV tylko ten zas\xf3b kt\xf3ry chcemy zmieni\u0107. Reszta zasob\xf3w nie b\u0119dzie brana pod uwag\u0119\xa0podczas wdra\u017cania tag\xf3w.")))),(0,r.kt)("p",null,"Poni\u017cej przedstawiam przyk\u0142ad jak to dzia\u0142a na mojej subskrypcji."),(0,r.kt)("p",null,"Uruchomienie skryptu:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GetAllTags.ps1")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Komenda: ./GetAllTags.ps1 -path /tags")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://lh6.googleusercontent.com/g2uknxvVr-r8zuu_JNgHwzMEWXDS_lCkJkvP0w2nsaraF1iUI-PfsBGgFDAMnSqGiPEN-oG5sg0RR5aQWAqnixT1BRO0RBcsIWEpJ48Jfztk-ioLi0NlKg-fFfHPUxjXg60DReVG",alt:null})),(0,r.kt)("p",null,"Na printscreenie mo\u017cesz zauwa\u017cy\u0107 output z informacjami jakie generowane s\u0105 przez skrypt."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Czy jeste\u015b zalogowany, je\u015bli nie to poprosi Ci\u0119 o zalogowanie si\u0119"),(0,r.kt)("li",{parentName:"ul"},"Ilo\u015b\u0107\xa0znalezionych grup zasob\xf3w oraz zasob\xf3w"),(0,r.kt)("li",{parentName:"ul"},"Informacja gdzie i jakie pliki s\u0105\xa0tworzone"),(0,r.kt)("li",{parentName:"ul"},"Lista zasob\xf3w")),(0,r.kt)("p",null,"Pliki CSV wygl\u0105daj\u0105 nast\u0119puj\u0105co:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Resource Group")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://lh3.googleusercontent.com/XiatuhcE3vx4Lr6g5rkz-JP48TjhJ-ydCdwySuAGgBccaVpVZKD9CfPF5xVpIuzU6IFM7PNj939dMpEviYAR3287SCr6F5y2cM4pu1i8500uzKNdRNSh16t8dX9GSosf7J2oDJFa",alt:null})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Resources")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://lh4.googleusercontent.com/m5u5NLpGw8DNyroSByMny-rIZsH11sZMs4tgFMixm_Lepfn0rjNf4XqLET6MvsT3YnK48PesD9GJQUkDtWJIuDKsUh7IolWD7BCDfHSQN4Ug_f6qdWpuPF2ns-8vRmnlRNtWptbp",alt:null})),(0,r.kt)("p",null,"Poni\u017cej przedstawi\u0119 edycj\u0119 tag\xf3w dla pliku z zasobami."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Uwaga! Je\u015bli chcesz zachowa\u0107 kopi\u0119 obecnego stanu, zabezpiecz wygenerowany plik lub zmie\u0144 jego nazw\u0119 na zupe\u0142nie inn\u0105."),"\xa0"),(0,r.kt)("p",null,"Poprawiony plik wygl\u0105da nast\u0119puj\u0105co. Zauwa\u017c, \u017ce wype\u0142ni\u0142em tagi dla wszystkich obiekt\xf3w oraz doda\u0142em nowy tag: Test:Key, aby pokaza\u0107 jak wygl\u0105da przypisywanie wielu tag\xf3w."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://lh6.googleusercontent.com/q4_FhHhAden4hD-gq6IJjhVRras8g-lAgwqCo4evhui6_dSF1wjIt6rZwHV23YbOWIuvlJihRbleddX46VkkUudBByLuX_lfGlrab1_U8Ya14-pdg9Xhrqd7hdzoQqpsxwaseZle",alt:null})),(0,r.kt)("p",null,"Wynik skryptu z wykonanymi zmianami:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Komenda: ./SetTagsResources.ps1 -path /tags")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://lh4.googleusercontent.com/49zIzivJeCzwtGRSBFcnzG4X0nr3nbtc1dxgJag7q3_tocRbvBcgu0m_DUf11179BBt1GWpHQalOmsyis3CDnEX3xCpgt-1w1Ic_-bR8KFREpnCOP-aXCxmAjefbS7mU7qJbRvkL",alt:null})),(0,r.kt)("p",null,"Efekt zmian w Portalu Azure:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://lh4.googleusercontent.com/O0XGlppGQzJYWYNOJcfKkxTo0ZcT4Hstc46TWolZUIr4Bi80Tq8P60Z1IwlMDgU-vwQ4yLvuj1cYWb9RYy67Z4BDPvFGjx704b9ZYUVbGNb9EFUatChC8Vv3YnHQi4g_1Lr1ciL2",alt:null})),(0,r.kt)("p",null,"Skrypt mo\u017cna dostosowa\u0107\xa0do swoich cel\xf3w tak, aby dzia\u0142a\u0142 na przyk\u0142ad dla wielu subskrypcji. Jest wiele opcji customizacji tego skryptu, kt\xf3re celowo pomin\u0105\u0142em. Skrypty dzia\u0142aj\u0105 modu\u0142owo wi\u0119c mo\u017cna ich \u0142atwo u\u017cy\u0107 z innym skryptem, a reszta zostanie przygotowana i wdro\u017cona na podstawie wprowadzonych danych z pliku."),(0,r.kt)("p",null,"Zapraszam do pozostawienia komentarza!"))}k.isMDXComponent=!0}}]);