"use strict";(globalThis.webpackChunkdocusaurus_site=globalThis.webpackChunkdocusaurus_site||[]).push([[3778],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var t=s(96540);const a={},r=t.createContext(a);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},45458:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/Clipboard21-8d851887072ff59a7d848fb97d94ba0e.jpg"},49343:e=>{e.exports=JSON.parse('{"permalink":"/auto-deployment-vm-with-vsts-agent-for-pool","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2018-05-27-auto-deployment-vm-with-vsts-agent-for-pool/index.md","source":"@site/blog/2018-05-27-auto-deployment-vm-with-vsts-agent-for-pool/index.md","title":"Auto deployment VM with VSTS agent for pool","description":"Azure DevOps agent to wa\u017cny element wszystkich wdro\u017ce\u0144. Potrzebujesz stworzy\u0107 w\u0142asnego agenta ADO? Zobacz jak to zrobi\u0107 w prosty i automatyczny spos\xf3b! Wszystko znajdziesz we wpisie.","date":"2018-05-27T00:00:00.000Z","tags":[{"inline":true,"label":"arm","permalink":"/tags/arm"},{"inline":true,"label":"automation","permalink":"/tags/automation"},{"inline":true,"label":"azure","permalink":"/tags/azure"},{"inline":true,"label":"deplyoment","permalink":"/tags/deplyoment"},{"inline":true,"label":"json","permalink":"/tags/json"},{"inline":true,"label":"microsoft","permalink":"/tags/microsoft"},{"inline":true,"label":"vsts","permalink":"/tags/vsts"},{"inline":true,"label":"ado","permalink":"/tags/ado"}],"readingTime":7.33,"hasTruncateMarker":true,"authors":[{"name":"Piotr Rogala","title":"MVP Azure & owner JustCloud.pl","url":"https://github.com/RogalaPiotr","page":{"permalink":"/authors/progala"},"socials":{"x":"https://x.com/RogalaPiotr","linkedin":"https://www.linkedin.com/in/rogalapiotr/","github":"https://github.com/RogalaPiotr","newsletter":"https://subscribepage.io/wroclaw-newsletter-workshops"},"imageURL":"https://avatars.githubusercontent.com/u/31566956?v=4","key":"progala"}],"frontMatter":{"authors":["progala"],"date":"2018-05-27","description":"Azure DevOps agent to wa\u017cny element wszystkich wdro\u017ce\u0144. Potrzebujesz stworzy\u0107 w\u0142asnego agenta ADO? Zobacz jak to zrobi\u0107 w prosty i automatyczny spos\xf3b! Wszystko znajdziesz we wpisie.","hide_table_of_contents":true,"keywords":["justcloud","ado","azure","microsoft azure","devops","agent","pipelines","deployment","azure devops agents"],"slug":"auto-deployment-vm-with-vsts-agent-for-pool","tags":["arm","automation","azure","deplyoment","json","microsoft","vsts","ado"],"title":"Auto deployment VM with VSTS agent for pool"},"unlisted":false,"prevItem":{"title":"Sk\u0105d uczy\u0107 si\u0119 o Microsoft Azure?","permalink":"/skad-uczyc-sie-o-microsoft-azure"},"nextItem":{"title":"Google Cloud Platform deployment VM z Ubuntu","permalink":"/google-cloud-platform-deployment-vm-z-ubuntu"}}')},55357:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/Clipboard22-1b82d9e149275cd7f3aa92dc67e94dc2.jpg"},74899:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});var t=s(49343),a=s(74848),r=s(28453);const o={authors:["progala"],date:"2018-05-27",description:"Azure DevOps agent to wa\u017cny element wszystkich wdro\u017ce\u0144. Potrzebujesz stworzy\u0107 w\u0142asnego agenta ADO? Zobacz jak to zrobi\u0107 w prosty i automatyczny spos\xf3b! Wszystko znajdziesz we wpisie.",hide_table_of_contents:!0,keywords:["justcloud","ado","azure","microsoft azure","devops","agent","pipelines","deployment","azure devops agents"],slug:"auto-deployment-vm-with-vsts-agent-for-pool",tags:["arm","automation","azure","deplyoment","json","microsoft","vsts","ado"],title:"Auto deployment VM with VSTS agent for pool"},i=void 0,l={authorsImageUrls:[void 0]},c=[{value:"<strong>GitHub</strong>:\xa0https://github.com/RogalaPiotr/JustCloudPublic/tree/master/simple-vm-with-installation-vsts-agent",id:"githubhttpsgithubcomrogalapiotrjustcloudpublictreemastersimple-vm-with-installation-vsts-agent",level:5},{value:"<strong>Sekcja Parameters:</strong>",id:"sekcja-parameters",level:2},{value:"<strong>Sekcja Variables:</strong>",id:"sekcja-variables",level:2},{value:"<strong>Sekcja Resources:</strong>",id:"sekcja-resources",level:2},{value:"<strong>Sekcja Outputs:</strong>",id:"sekcja-outputs",level:2},{value:"<strong>Aby wykona\u0107 deployment nale\u017cy utworzy\u0107 Resource Group&#39;\u0119:</strong>",id:"aby-wykona\u0107-deployment-nale\u017cy-utworzy\u0107-resource-group\u0119",level:3},{value:"<strong>Wykonanie deployment\u2019u:</strong>",id:"wykonanie-deploymentu",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Wszyscy kt\xf3ry robi\u0105 depyolemnty z VSTS spotykaj\u0105 si\u0119 z sytuacj\u0105, kiedy standardowe 240min si\u0119 ko\u0144czy i trzeba stworzy\u0107 sobie tak\u0105 maszyn\u0119. Sam robi\u0142em tak\u0105 maszyn\u0119 par\u0119 razy i kiedy zn\xf3w pojawi\u0142a si\u0119 ta konieczno\u015b\u0107 postanowi\u0142em stworzy\u0107 automatyczny deployment kt\xf3ry nam stworzy z JSON'a ca\u0142a maszynk\u0119 i podepnie j\u0105 do Agent pool w VSTS."}),"\n",(0,a.jsx)(n.p,{children:"Mia\u0142em par\u0119 pomys\u0142\xf3w, aby zrobi\u0107 bardzo uniwersalny template kt\xf3ry nie tylko przyda si\u0119 wam, ale r\xf3wnie\u017c mi w przysz\u0142o\u015bci do budowania innych szablon\xf3w. Tak\u017ce w skr\xf3cie opisz\u0119 ciekawostki kt\xf3re zastosowa\u0142em szablonie, kt\xf3ry znajdziecie na moim GitHubie."}),"\n",(0,a.jsx)(n.p,{children:"Mia\u0142em par\u0119 pomys\u0142\xf3w, aby zrobi\u0107 bardzo uniwersalny template kt\xf3ry nie tylko przyda si\u0119 wam, ale r\xf3wnie\u017c mi w przysz\u0142o\u015bci do budowania innych szablon\xf3w. Tak\u017ce w skr\xf3cie opisz\u0119 ciekawostki kt\xf3re zastosowa\u0142em szablonie, kt\xf3ry znajdziecie na moim GitHubie."}),"\n",(0,a.jsxs)(n.h5,{id:"githubhttpsgithubcomrogalapiotrjustcloudpublictreemastersimple-vm-with-installation-vsts-agent",children:[(0,a.jsx)(n.strong,{children:"GitHub"}),":\xa0",(0,a.jsx)(n.a,{href:"https://github.com/RogalaPiotr/JustCloudPublic/tree/master/simple-vm-with-installation-vsts-agent",children:"https://github.com/RogalaPiotr/JustCloudPublic/tree/master/simple-vm-with-installation-vsts-agent"})]}),"\n",(0,a.jsx)(n.p,{children:"Za\u0142o\u017cenie dotycz\u0105ce szablonu: chcia\u0142bym doda\u0107 informacj\u0119, gdzie wa\u017cnym jest zwr\xf3cenie uwagi, \u017ce maszyna ma by\u0107 odizolowana od naszej sieci wewn\u0119trznej, dlatego szablon jest infrastruktura stand alone, aby by\u0142o bezpiecznie i w razie czego mo\u017cna j\u0105 usun\u0105 lub powo\u0142a\u0107 wi\u0119cej agent\xf3w do deployment\u2019\xf3w."}),"\n",(0,a.jsx)(n.h1,{id:"opis-szablonu",children:"Opis szablonu"}),"\n",(0,a.jsx)(n.h2,{id:"sekcja-parameters",children:(0,a.jsx)(n.strong,{children:"Sekcja Parameters:"})}),"\n",(0,a.jsx)(n.p,{children:"w tej sekcji podajemy dane kt\xf3re przydadz\u0105 nam si\u0119 do deplyment\u2019u i automatycznego pod\u0142\u0105czenia do VSTS'a."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"adminUsername"}),", ",(0,a.jsx)(n.strong,{children:"adminPassword"})," - lokalny u\u017cytkownik i has\u0142o,"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"dnsLabelPrefix"})," - zostanie automatycznie wygenerowany podczas deployment\u2019u, wi\u0119c nie ma konieczno\u015bci go zmienia\u0107,"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"vmName"})," - nazwa naszej maszyny oraz na podstawie tej nazwy zostan\u0105 nazwane wszystkie nasze resource jest: VNET, NSG, Storage..."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"urlvsts"})," - adres do naszego projektu VSTS np.: ",(0,a.jsx)(n.a,{href:"https://project1.visualstudio.com",children:"https://project1.visualstudio.com"}),","]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"auth"})," - rodzaj po\u015bwiadczenia - wybrany domy\u015blnie PAT,"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"token"})," - token security kt\xf3ry umo\u017cliwi nam pod\u0142\u0105czenie si\u0119 do projektu. Wi\u0119cej informacji jak stworzy\u0107 Security Token poni\u017cej:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/vsts/build-release/actions/agents/v2-windows?view=vsts",children:(0,a.jsx)(n.strong,{children:"https://docs.microsoft.com/en-us/vsts/build-release/actions/agents/v2-windows?view=vsts"})})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"pool"})," - nazwa puli, do kt\xf3rej zostanie dodana maszyna w VSTS'ie - ustawiony jest na default"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"AccessIPNSG"})," - adres, kt\xf3ry tutaj podacie zostanie dodany do NSG i tylko z tego adresu dostaniecie si\u0119 po RDP do maszyny,"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Tag"})," - tagi mog\u0105 ulec waszej modyfikacji ustawione s\u0105 na Project: VSTSAgent."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"sekcja-variables",children:(0,a.jsx)(n.strong,{children:"Sekcja Variables:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"vmsize"}),' - ustawiony na "Standard_B1s" - dosy\u0107 tani i wystarczaj\u0105cy na maszyn\u0119 deployment\u2019owy - pami\u0119taj, aby sprawdzi\u0107, czy masz mo\u017cliwo\u015b\u0107 deploy\u2019owania tej maszyny w swojej subskrypcji w innym przypadku zg\u0142o\u015b request do supportu Microsoft w celu uruchomienia wielko\u015bci B_size.']}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"urldonwloadagent"})," - w tym miejscu jest podany link do \u015bci\u0105gni\u0119cia aktualnego zip'a z agentem VSTS - w razie zmiany wersji nale\u017cy zaktualizowa\u0107 link na aktualny"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"filescriptURI"})," - skrypt napisany przeze mnie w celu automatycznego pobrania i zainstalowania agenta na maszynie:\xa0",(0,a.jsx)(n.a,{href:"https://raw.githubusercontent.com/RogalaPiotr/JustCloudPublic/master/simple-vm-with-installation-vsts-agent/vstsagent.ps1",children:"https://raw.githubusercontent.com/RogalaPiotr/JustCloudPublic/master/simple-vm-with-installation-vsts-agent/vstsagent.ps1"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"filescriptURISplit"}),' - bardzo ciekawa funkcja, kt\xf3ra rozbija powy\u017cszy url na tekst tam, gdzie jest slah "/" co w efekcie generuje nam obiekt']}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["wi\u0119cej ciekawych informacji w dokumentacji Microsoft:\xa0",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-template-functions",children:"https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-template-functions"})})]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"filescriptName"})," - kolejna fajna funkcja, gdzie na podstawie powy\u017cszego splita zabieramy nazw\u0119 skryptu, kt\xf3ry pos\u0142u\u017cy nam do instalacji w CustomScriptExtension,"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"agentname"})," - ka\u017cdy dodany Agent do puli w VSTS b\u0119dzie nosi\u0142 nazw\u0119 NazwaMaszynyagent."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"sekcja-resources",children:(0,a.jsx)(n.strong,{children:"Sekcja Resources:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"type: Microsoft.Network/networkSecurityGroups"})," - NSG z dost\u0119pem RDP tylko z adresu IP kt\xf3ry dodamy podczas deploy\u2019mentu parametr: AccessIPNSG"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"type: Microsoft.Network/publicIPAddresses"})," - Publiczny adres dla naszej VM, aby m\xf3c si\u0119 do niej pod\u0142\u0105czy\u0107 z zewn\u0105trz."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"type: Microsoft.Network/virtualNetworks"})," - VNet"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"type: Microsoft.Compute/virtualMachines"})," - tworzenie maszyny wirtualnej z Windows 2016 i Managed Disk"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"type: Microsoft.Compute/virtualMachines/extensions"}),' - instalacja agenta VSTS, bazuj\u0105c na napisanym skrypcie i udost\u0119pnionym na GitHubie:\xa0vstsagent.ps1 zostanie on u\u017cyty podczas deplyoment\u2019u a podczas jego wykonywaniu dodamy informacj\u0119 zwi\u0105zane z url VSTS, tokenem itp. Pe\u0142na komenda w linii 257: "commandToExecute"']}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"type: Microsoft.DevTestLab/schedules"})," - dzi\u0119ki temu nasza maszynie b\u0119dzie wy\u0142\u0105czana codziennie o 18:00 zona: W. Europe Standard Time - ten feature dzia\u0142a tylko kiedy maszyna jest w\u0142\u0105czona pozwoli to nam zapomnie\u0107 o wy\u0142\u0105czaniu, a mimo wszystko nie b\u0119dziemy traci\u0107 pieni\u0119dzy za jej bezczynno\u015b\u0107."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"sekcja-outputs",children:(0,a.jsx)(n.strong,{children:"Sekcja Outputs:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"PublicDNS"})," - po wykonaniu deployment\u2019u wy\u015bwietli nam publiczny adres DNS dla VM,"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Hostname"})," - wy\u015bwietli nazw\u0119 maszyny, kt\xf3r\u0105 wprowadzili\u015bmy w parametrach,"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"VSTSAgentName"})," - wy\u015bwietli nazw\u0119 agenta jaka b\u0119dzie widoczna w VSTS,"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"VSTSProjectName"})," - wy\u015bwietli nazw\u0119 projektu VSTS jaki zosta\u0142 wprowadzony,"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"ScriptURI"})," - wy\u015bwietli \u017ar\xf3d\u0142o z jakiego zosta\u0142 pobrany skrypt do instalacji Agenta,"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"AccessRDPFrom"})," - wy\u015bwietli adres IP kt\xf3ry zosta\u0142 dodany do NSG, aby mia\u0142 dost\u0119p do RDP"]}),"\n"]}),"\n",(0,a.jsx)(n.h1,{id:"szablon",children:"Szablon:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",\n  "contentVersion": "1.0.0.0",\n  "parameters": {\n    "adminUsername": {\n      "type": "string",\n      "metadata": {\n        "description": "Username for the Virtual Machine."\n      }\n    },\n    "adminPassword": {\n      "type": "securestring",\n      "metadata": {\n        "description": "Password for the Virtual Machine."\n      }\n    },\n    "dnsLabelPrefix": {\n      "type": "string",\n      "defaultValue": "[concat(\'x\', uniqueString(resourceGroup().id))]",\n      "metadata": {\n        "description": "Unique DNS Name for the Public IP used to access the Virtual Machine."\n      }\n    },\n    "vmName": {\n      "type": "string",\n      "metadata": {\n        "description": "Unique DNS Name for the Public IP used to access the Virtual Machine."\n      }\n    },\n    "urlvsts": {\n      "type": "string",\n      "metadata": {\n        "description": "URL for your VSTS Project ex. https://project1.visualstudio.com."\n      }\n    },\n    "auth": {\n      "type": "string",\n      "defaultValue": "pat",\n      "metadata": {\n        "description": "Unique DNS Name for the Public IP used to access the Virtual Machine."\n      }\n    },\n    "token": {\n      "type": "securestring",\n      "metadata": {\n        "description": "Security token for VSTS project."\n      }\n    },\n    "pool": {\n      "type": "string",\n      "metadata": {\n        "description": "Pool name in VSTS - Default is a main."\n      }\n    },\n    "AccessIPNSG": {\n      "type": "string",\n      "metadata": {\n        "description": "Your publif IP it will added for NSG for connection via RDP."\n      }\n    },\n    "numberagents": {\n      "type": "int",\n      "metadata": {\n        "description": "Numbers of agents for installation"\n      }\n    },\n    "tag": {\n      "type": "string",\n      "metadata": {\n          "description": "Tag Values"\n      }\n  }\n},\n  "variables": {\n    "storageAccountName": "[concat(\'stor\', uniquestring(resourceGroup().id))]",\n    "windowsOSVersion": "2019-Datacenter",\n    "vmsize": "Standard_B2ms",\n    "publicIPAddressName": "[concat(parameters(\'vmName\'), \'-pip\')]",\n    "virtualNetworkName": "[concat(parameters(\'vmName\'), \'-vnet\')]",\n    "NSGname": "[concat(parameters(\'vmName\'), \'-nsg\')]",\n    "nicName": "[concat(parameters(\'vmName\'), \'-nic\')]",\n    "subnetName": "[concat(parameters(\'vmName\'), \'-subnet\')]",\n    "addressPrefix": "10.0.0.0/16",\n    "subnetPrefix": "10.0.0.0/24",\n    "subnetRef": "[resourceId(\'Microsoft.Network/virtualNetworks/subnets\', variables(\'virtualNetworkName\'), variables(\'subnetName\'))]",\n    "urldonwloadagent": "https://vstsagentpackage.azureedge.net/agent/2.155.1/vsts-agent-win-x64-2.155.1.zip",\n    "filescriptURI": "https://raw.githubusercontent.com/RogalaPiotr/JustCloudPublic/master/simple-vm-with-installation-vsts-agent/vstsagent.ps1",\n    "filescriptURISplit": "[split(variables(\'filescriptURI\'), \'/\')]",\n    "filescriptName": "[last(variables(\'filescriptURISplit\'))]",\n    "agentname": "[parameters(\'vmName\')]"\n  },\n  "resources": [\n    {\n      "type": "Microsoft.Storage/storageAccounts",\n      "name": "[variables(\'storageAccountName\')]",\n      "apiVersion": "2015-06-15",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "properties": {\n        "accountType": "Standard_LRS"\n      }\n    },\n    {\n      "type": "Microsoft.Network/networkSecurityGroups",\n      "name": "[variables(\'NSGName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "apiVersion": "2018-03-01",\n      "properties": {\n        "securityRules": [\n          {\n            "name": "RDP",\n            "properties": {\n              "description": "Allow IP for RDP",\n              "protocol": "TCP",\n              "sourcePortRange": "*",\n              "destinationPortRange": "3389",\n              "sourceAddressPrefix": "[parameters(\'AccessIPNSG\')]",\n              "destinationAddressPrefix": "*",\n              "access": "Allow",\n              "priority": 100,\n              "direction": "Inbound"\n            }\n          }\n        ]\n      }\n    },\n    {\n      "apiVersion": "2016-03-30",\n      "type": "Microsoft.Network/publicIPAddresses",\n      "name": "[variables(\'publicIPAddressName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "properties": {\n        "publicIPAllocationMethod": "Dynamic",\n        "dnsSettings": {\n          "domainNameLabel": "[parameters(\'dnsLabelPrefix\')]"\n        }\n      }\n    },\n    {\n      "apiVersion": "2016-03-30",\n      "type": "Microsoft.Network/virtualNetworks",\n      "name": "[variables(\'virtualNetworkName\')]",\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Network/networkSecurityGroups/\', variables(\'NSGName\'))]"\n      ],\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "properties": {\n        "addressSpace": {\n          "addressPrefixes": [\n            "[variables(\'addressPrefix\')]"\n          ]\n        },\n        "subnets": [\n          {\n            "name": "[variables(\'subnetName\')]",\n            "properties": {\n              "addressPrefix": "[variables(\'subnetPrefix\')]",\n              "networkSecurityGroup": {\n                "id": "[resourceId(\'Microsoft.Network/networkSecurityGroups\',variables(\'NSGName\'))]"\n            }\n            }\n          }\n        ]\n      }\n    },\n    {\n      "apiVersion": "2016-03-30",\n      "type": "Microsoft.Network/networkInterfaces",\n      "name": "[variables(\'nicName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Network/publicIPAddresses/\', variables(\'publicIPAddressName\'))]",\n        "[resourceId(\'Microsoft.Network/virtualNetworks/\', variables(\'virtualNetworkName\'))]"\n      ],\n      "properties": {\n        "ipConfigurations": [\n          {\n            "name": "ipconfig1",\n            "properties": {\n              "privateIPAllocationMethod": "Dynamic",\n              "publicIPAddress": {\n                "id": "[resourceId(\'Microsoft.Network/publicIPAddresses\',variables(\'publicIPAddressName\'))]"\n              },\n              "subnet": {\n                "id": "[variables(\'subnetRef\')]"\n              }\n            }\n          }\n        ]\n      }\n    },\n    {\n      "apiVersion": "2016-04-30-preview",\n      "type": "Microsoft.Compute/virtualMachines",\n      "name": "[parameters(\'vmName\')]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Network/networkInterfaces/\', variables(\'nicName\'))]",\n        "[concat(\'Microsoft.Storage/storageAccounts/\', variables(\'storageAccountName\'))]"\n      ],\n      "properties": {\n        "licenseType": "Windows_Server",\n        "hardwareProfile": {\n          "vmSize": "[variables(\'vmsize\')]"\n        },\n        "osProfile": {\n          "computerName": "[parameters(\'vmName\')]",\n          "adminUsername": "[parameters(\'adminUsername\')]",\n          "adminPassword": "[parameters(\'adminPassword\')]"\n        },\n        "storageProfile": {\n          "imageReference": {\n            "publisher": "MicrosoftWindowsServer",\n            "offer": "WindowsServer",\n            "sku": "[variables(\'windowsOSVersion\')]",\n            "version": "latest"\n          },\n          "osDisk": {\n            "name": "[concat(parameters(\'vmName\'),\'-os\')]",\n            "vhd": {\n              "uri": "[concat(\'http://\',variables(\'storageAccountName\'),\'.blob.core.windows.net/vhds/\',parameters(\'vmName\'),\'-vm-os.vhd\')]"\n            },\n            "caching": "ReadWrite",\n            "createOption": "FromImage"\n          }\n        },\n        "networkProfile": {\n          "networkInterfaces": [\n            {\n              "id": "[resourceId(\'Microsoft.Network/networkInterfaces\',variables(\'nicName\'))]"\n            }\n          ]\n        }\n      },\n      "resources": [\n        {\n          "name": "[concat(parameters(\'vmName\'),\'/AzureDevOpsAgentInstall\')]",\n          "type": "Microsoft.Compute/virtualMachines/extensions",\n          "location": "[resourceGroup().location]",\n          "tags": {\n            "Project": "[parameters(\'tag\')]"\n          },\n          "dependsOn": [\n            "[concat(\'Microsoft.Compute/virtualMachines/\', parameters(\'vmName\'))]"\n          ],\n          "apiVersion": "2015-06-15",\n          "properties": {\n            "publisher": "Microsoft.Compute",\n            "type": "CustomScriptExtension",\n            "typeHandlerVersion": "1.9",\n            "autoUpgradeMinorVersion": true,\n            "settings": {\n              "fileUris": [\n                "[variables(\'filescriptURI\')]"\n                ]\n            },\n            "protectedSettings": {\n              "commandToExecute": "[concat(\'powershell -ExecutionPolicy Unrestricted -File \',variables(\'filescriptName\'),\' -url \',variables(\'urldonwloadagent\'),\' -urlvsts \',parameters(\'urlvsts\'),\' -auth \',parameters(\'auth\'),\' -token \',parameters(\'token\'),\' -pool \',parameters(\'pool\'),\' -agentname \',variables(\'agentname\'), \' -numberagents \',parameters(\'numberagents\'))]"\n            }\n          }\n        }\n      ]\n    },\n    {\n      "apiVersion": "2016-05-15",\n      "type": "Microsoft.DevTestLab/schedules",\n      "name": "[concat(\'shutdown-computevm-\', parameters(\'vmName\'))]",\n      "location": "[resourceGroup().location]",\n      "tags": {\n        "Project": "[parameters(\'tag\')]"\n      },\n      "dependsOn": [\n        "[resourceId(\'Microsoft.Compute/virtualMachines/\', parameters(\'vmName\'))]"\n      ],\n      "properties": {\n        "status":"Enabled",\n        "timeZoneId":"W. Europe Standard Time",\n        "taskType":"ComputeVmShutdownTask",\n        "notificationSettings":{\n          "status":"Disabled",\n          "timeInMinutes":15,\n          "webhookUrl":null\n        },\n        "targetResourceId":"[resourceId(\'Microsoft.Compute/virtualMachines\', parameters(\'vmName\'))]",\n        "dailyRecurrence":{\n          "time":"1800"\n        }\n      }\n    }\n  ],\n  "outputs": {\n    "PublicDNS": {\n      "type" : "string",\n      "value": "[reference(variables(\'publicIPAddressName\')).dnsSettings.fqdn]"\n    },\n    "HostName": {\n      "type" : "string",\n      "value": "[parameters(\'vmName\')]"\n    },\n    "VSTSAgentName": {\n      "type" : "string",\n      "value": "[variables(\'agentname\')]"\n    },  \n    "VSTSProjectName": {\n      "type" : "string",\n      "value": "[parameters(\'urlvsts\')]"\n    },  \n    "ScritpURI": {\n      "type" : "string",\n      "value": "[variables(\'filescriptURI\')]"\n    },\n    "AccessRDPFrom": {\n      "type" : "string",\n      "value": "[parameters(\'accessIPNSG\')]"\n    }\n  }\n}\n\n'})}),"\n",(0,a.jsx)(n.h1,{id:"przyk\u0142ad",children:(0,a.jsx)(n.strong,{children:"Przyk\u0142ad:"})}),"\n",(0,a.jsx)(n.h3,{id:"aby-wykona\u0107-deployment-nale\u017cy-utworzy\u0107-resource-group\u0119",children:(0,a.jsx)(n.strong,{children:"Aby wykona\u0107 deployment nale\u017cy utworzy\u0107 Resource Group'\u0119:"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"New-AzureRMResourceGroup -Name VSTS -Location westeurope"})}),"\n",(0,a.jsx)(n.h3,{id:"wykonanie-deploymentu",children:(0,a.jsx)(n.strong,{children:"Wykonanie deployment\u2019u:"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:'New-AzureRMResourceGroupDeployment -ResourceGroupName VSTS -TemplateURI "https://raw.githubusercontent.com/RogalaPiotr/JustCloudPublic/master/simple-vm-with-installation-vsts-agent/azuredeploy.json" -Verbose'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Efekt w portalu po deploy\u2019mencie:"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:s(45458).A+"",width:"1360",height:"637"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Widok puli agent\xf3w w VSTS:"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:s(55357).A+"",width:"925",height:"335"})}),"\n",(0,a.jsx)(n.p,{children:"Maszyna jest gotowa do deploy\u2019ment\xf3w, je\u015bli potrzebujesz wi\u0119cej maszyn mo\u017cesz bez oporu deploy\u2019owa\u0107 wi\u0119ksz\u0105 ilo\u015b\u0107 :)"}),"\n",(0,a.jsx)(n.p,{children:"Czas deplymentu to: 15 minutes 46 seconds."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);