"use strict";(globalThis.webpackChunkdocusaurus_site=globalThis.webpackChunkdocusaurus_site||[]).push([[8139],{5852:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/2025-12-03_21-41-04-d023d0eb308ff7a3d818dce562fe6c71.png"},14338:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/2025-12-03_21-45-42-136d03bed420e97e7343d19a45ce2d78.png"},28453:(e,i,n)=>{n.d(i,{R:()=>t,x:()=>s});var a=n(96540);const r={},o=a.createContext(r);function t(e){const i=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),a.createElement(o.Provider,{value:i},e.children)}},29279:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/2025-12-03_21-44-22-686bc7e067b6183589a9c27a47dc66dd.png"},55986:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/2025-12-03_21-36-39-c0be36da6463490f0e06ccb8178dc8a3.png"},63492:e=>{e.exports=JSON.parse('{"permalink":"/2025/11/20/github-actions-oidc-federation-azure","source":"@site/blog/2025/11-20-github-actions-oidc-federation-azure/index.md","title":"Bezpieczne wdra\u017canie do Azure z GitHub Actions: Konfiguracja OIDC","description":"Poradnik krok po kroku: Jak skonfigurowa\u0107 bezpieczne po\u0142\u0105czenie GitHub Actions z Azure u\u017cywaj\u0105c OIDC i Azure CLI. Pozb\u0105d\u017a si\u0119 hase\u0142 i kluczy!","date":"2025-11-20T00:00:00.000Z","tags":[{"inline":true,"label":"azure","permalink":"/tags/azure"},{"inline":true,"label":"github-actions","permalink":"/tags/github-actions"},{"inline":true,"label":"devops","permalink":"/tags/devops"},{"inline":true,"label":"security","permalink":"/tags/security"},{"inline":true,"label":"tutorial","permalink":"/tags/tutorial"}],"readingTime":4.21,"hasTruncateMarker":true,"authors":[{"name":"Piotr Rogala","title":"MVP Azure & owner JustCloud.pl","url":"https://github.com/RogalaPiotr","page":{"permalink":"/authors/progala"},"description":"Microsoft Azure MVP od 2017 roku i certyfikowany trener MCT. Ekspert w dziedzinie cloud computing,  Azure DevOps, automatyzacji i governance. W\u0142a\u015bciciel JustCloud.pl. Dziel\u0119 si\u0119 wiedz\u0105 praktyczn\u0105  z wdro\u017ce\u0144 enterprise oraz best practices dla transformacji chmurowej. Prowadz\u0119 warsztaty,  prelekcje i konsultacje z zakresu Microsoft Azure we Wroc\u0142awiu i online.\\n","socials":{"x":"https://x.com/RogalaPiotr","linkedin":"https://www.linkedin.com/in/rogalapiotr/","github":"https://github.com/RogalaPiotr","newsletter":"https://web.justcloud.pl/#workshops"},"imageURL":"https://avatars.githubusercontent.com/u/31566956?v=4","key":"progala"}],"frontMatter":{"authors":["progala"],"comments":true,"date":"2025-11-20","description":"Poradnik krok po kroku: Jak skonfigurowa\u0107 bezpieczne po\u0142\u0105czenie GitHub Actions z Azure u\u017cywaj\u0105c OIDC i Azure CLI. Pozb\u0105d\u017a si\u0119 hase\u0142 i kluczy!","keywords":["azure","github actions","oidc","workload identity federation","azure cli","devops","security","ci/cd"],"tags":["azure","github-actions","devops","security","tutorial"],"title":"Bezpieczne wdra\u017canie do Azure z GitHub Actions: Konfiguracja OIDC"},"unlisted":false,"nextItem":{"title":"Szybkie wdro\u017cenie Azure OpenAI z Terraform i AVM","permalink":"/deployment-azure-openai-terraform-avm"}}')},64889:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/2025-12-03_21-47-21-fcc6eace3c390e56238165b3a2a614d5.png"},66052:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/2025-12-07_23-36-17-8526044f9a54c4a9e6cbe2a5b1d43a91.png"},73828:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/2025-12-07_23-22-38-16484a1d8261cfa3cabb2b945606179b.png"},95834:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var a=n(63492),r=n(74848),o=n(28453);const t={authors:["progala"],comments:!0,date:"2025-11-20",description:"Poradnik krok po kroku: Jak skonfigurowa\u0107 bezpieczne po\u0142\u0105czenie GitHub Actions z Azure u\u017cywaj\u0105c OIDC i Azure CLI. Pozb\u0105d\u017a si\u0119 hase\u0142 i kluczy!",keywords:["azure","github actions","oidc","workload identity federation","azure cli","devops","security","ci/cd"],tags:["azure","github-actions","devops","security","tutorial"],title:"Bezpieczne wdra\u017canie do Azure z GitHub Actions: Konfiguracja OIDC"},s=void 0,c={authorsImageUrls:[void 0]},d=[{value:"Dlaczego OIDC?",id:"dlaczego-oidc",level:2},{value:"Wymagania",id:"wymagania",level:2},{value:"Konfiguracja krok po kroku",id:"konfiguracja-krok-po-kroku",level:2},{value:"1. Tworzenie aplikacji i Service Principal",id:"1-tworzenie-aplikacji-i-service-principal",level:3},{value:"2. Nadawanie uprawnie\u0144",id:"2-nadawanie-uprawnie\u0144",level:3},{value:"3. Konfiguracja federacji (OIDC)",id:"3-konfiguracja-federacji-oidc",level:3},{value:"4. Pobranie danych App Registration",id:"4-pobranie-danych-app-registration",level:3},{value:"5. Konfiguracja GitHub",id:"5-konfiguracja-github",level:3},{value:"6. Testowy Pipeline",id:"6-testowy-pipeline",level:3},{value:"Przydatne linki",id:"przydatne-linki",level:2}];function l(e){const i={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{children:"Chcesz skonfigurowa\u0107 bezpieczny dost\u0119p do Microsoft Azure z poziomu GitHub Actions dla wdro\u017ce\u0144 infrastruktury i aplikacji? Je\u015bli tak, to ten przewodnik jest dla Ciebie. Poka\u017c\u0119 Ci, jak to zrobi\u0107 krok po kroku, wykorzystuj\u0105c Azure CLI."}),"\n",(0,r.jsx)(i.h2,{id:"dlaczego-oidc",children:"Dlaczego OIDC?"}),"\n",(0,r.jsxs)(i.p,{children:["Dlaczego to rozwi\u0105zanie jest bezpieczniejsze od tradycyjnego Service Principal z kluczem (secret)? Poniewa\u017c ",(0,r.jsx)(i.strong,{children:"nie tworzymy konta z has\u0142em"}),", kt\xf3re trzeba rotowa\u0107 i chroni\u0107 przed wyciekiem."]}),"\n",(0,r.jsxs)(i.p,{children:["Mechanizm ten dzia\u0142a na zasadzie ",(0,r.jsx)(i.strong,{children:"Workload Identity Federation"}),". Polega on na powi\u0105zaniu obiektu Service Principal w Azure z konkretnym repozytorium GitHub. Dzi\u0119ki protoko\u0142owi OIDC (OpenID Connect), GitHub wymienia sw\xf3j token to\u017csamo\u015bci na kr\xf3tko \u017cyj\u0105cy token dost\u0119pu do Azure."]}),"\n",(0,r.jsxs)(i.p,{children:["Wi\u0119cej o tym mechanizmie przeczytasz w ",(0,r.jsx)(i.a,{href:"https://learn.microsoft.com/entra/workload-id/workload-identity-federation-create-trust?WT.mc_id=AZ-MVP-5002690",children:"dokumentacji Microsoft"}),"."]}),"\n",(0,r.jsx)(i.h2,{id:"wymagania",children:"Wymagania"}),"\n",(0,r.jsx)(i.p,{children:"Do wykonania poni\u017cszych krok\xf3w b\u0119dziesz potrzebowa\u0107 Azure CLI."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Co to jest Azure CLI?"}),": ",(0,r.jsx)(i.a,{href:"https://learn.microsoft.com/cli/azure/what-is-azure-cli?view=azure-cli-latest&WT.mc_id=AZ-MVP-5002690",children:"Wprowadzenie"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Instalacja"}),": ",(0,r.jsx)(i.a,{href:"https://learn.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest&WT.mc_id=AZ-MVP-5002690",children:"Instrukcja instalacji"})]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"konfiguracja-krok-po-kroku",children:"Konfiguracja krok po kroku"}),"\n",(0,r.jsxs)(i.p,{children:["Po zalogowaniu si\u0119 do Azure (",(0,r.jsx)(i.code,{children:"az login"}),"), wykonaj poni\u017csze polecenia w terminalu. Dla wygody mo\u017cesz te\u017c u\u017cy\u0107 Cloud Shell dost\u0119pnego w Azure Portal."]}),"\n",(0,r.jsx)(i.h3,{id:"1-tworzenie-aplikacji-i-service-principal",children:"1. Tworzenie aplikacji i Service Principal"}),"\n",(0,r.jsx)(i.p,{children:"Najpierw utworzymy App Registration oraz Service Principal."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:'# Tworzymy App Registration i pobieramy appId\naz ad app create --display-name "gh-action-private" --query "appId" -o tsv\n\n# UWAGA: Skopiuj wy\u015bwietlony appId. B\u0119dzie on u\u017cywany w kolejnych komendach jako [appId].\n\n# Tworzymy Service Principal dla aplikacji\naz ad sp create --id [appId]\n'})}),"\n",(0,r.jsxs)(i.p,{children:["Pierwsza komenda utworzy nowy obiekt ",(0,r.jsx)(i.strong,{children:"App Registration"})," w Microsoft Entra ID."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Wynik polecenia tworzenia App Registration w terminalu",src:n(29279).A+"",width:"2264",height:"1164"})}),"\n",(0,r.jsxs)(i.p,{children:["Druga komenda utworzy obiekt ",(0,r.jsx)(i.strong,{children:"Enterprise Application"})," (Service Principal) o tej samej nazwie."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Widok Enterprise Application w portalu Azure",src:n(66052).A+"",width:"1412",height:"946"})}),"\n",(0,r.jsx)(i.h3,{id:"2-nadawanie-uprawnie\u0144",children:"2. Nadawanie uprawnie\u0144"}),"\n",(0,r.jsxs)(i.p,{children:["Po utworzeniu to\u017csamo\u015bci, musimy nada\u0107 jej uprawnienia do subskrypcji. W tym przyk\u0142adzie u\u017cyjemy roli ",(0,r.jsx)(i.strong,{children:"Contributor"}),"."]}),"\n",(0,r.jsxs)(i.blockquote,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Dobra praktyka:"})," Jestem zwolennikiem nadawania najni\u017cszych mo\u017cliwych uprawnie\u0144 (Least Privilege). Jednak dla og\xf3lnych wdro\u017ce\u0144 infrastruktury, rola Contributor na poziomie subskrypcji jest cz\u0119sto niezb\u0119dnym minimum."]}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"# Podmie\u0144 [appId] na ID z poprzedniego kroku oraz wpisz swoje ID subskrypcji\naz role assignment create --assignee [appId] --role Contributor --scope /subscriptions/[TWOJE_SUBSCRIPTION_ID]\n"})}),"\n",(0,r.jsx)(i.p,{children:"Nadane uprawnienia mo\u017cesz sprawdzi\u0107 w portalu Azure, wchodz\u0105c w Subskrypcj\u0119 -> IAM -> Role Assignments."}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Weryfikacja przypisania roli Contributor w portalu Azure",src:n(55986).A+"",width:"1852",height:"1420"})}),"\n",(0,r.jsx)(i.h3,{id:"3-konfiguracja-federacji-oidc",children:"3. Konfiguracja federacji (OIDC)"}),"\n",(0,r.jsx)(i.p,{children:"Teraz najwa\u017cniejszy krok \u2013 powi\u0105zanie aplikacji Azure z repozytorium GitHub."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:'# Podmie\u0144 [appId] oraz [NAZWA_TWOJEGO_REPO] (format: U\u017cytkownik/Repozytorium)\naz ad app federated-credential create --id [appId] --parameters \'{"name": "gh-action-private", "issuer": "https://token.actions.githubusercontent.com", "subject": "repo:RogalaPiotr/[NAZWA_TWOJEGO_REPO]:ref:refs/heads/main", "description": "OIDC federacja dla GitHub Actions repo [NAZWA_TWOJEGO_REPO]", "audiences": ["api://AzureADTokenExchange"]}\'\n'})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Potwierdzenie utworzenia federacji w terminalu",src:n(5852).A+"",width:"2934",height:"830"})}),"\n",(0,r.jsx)(i.p,{children:"W sekcji App Registration mo\u017cesz zweryfikowa\u0107 poprawno\u015b\u0107 utworzonej federacji:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Weryfikacja federacji w portalu Azure",src:n(64889).A+"",width:"2732",height:"1392"})}),"\n",(0,r.jsx)(i.h3,{id:"4-pobranie-danych-app-registration",children:"4. Pobranie danych App Registration"}),"\n",(0,r.jsxs)(i.p,{children:["Aby skonfigurowa\u0107 GitHub Actions, potrzebujemy trzech warto\u015bci: ",(0,r.jsx)(i.code,{children:"Client ID"}),", ",(0,r.jsx)(i.code,{children:"Tenant ID"})," oraz ",(0,r.jsx)(i.code,{children:"Subscription ID"}),"."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:'# Pobierz Client ID (Application ID) - je\u015bli zgubi\u0142e\u015b\naz ad app show --id [appId] --query "appId" -o tsv\n\n# Pobierz Tenant ID\naz account show --query tenantId -o tsv\n\n# Subscription ID masz ju\u017c z kroku 2.\n'})}),"\n",(0,r.jsx)(i.h3,{id:"5-konfiguracja-github",children:"5. Konfiguracja GitHub"}),"\n",(0,r.jsxs)(i.p,{children:["Przejd\u017a teraz do swojego repozytorium na GitHub. Wejd\u017a w ",(0,r.jsx)(i.strong,{children:"Settings"})," -> ",(0,r.jsx)(i.strong,{children:"Secrets and variables"})," -> ",(0,r.jsx)(i.strong,{children:"Actions"})," i dodaj nast\u0119puj\u0105ce sekrety (Repository secrets):"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"AZURE_CLIENT_ID"})," \u2013 Tw\xf3j Application ID"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"AZURE_TENANT_ID"})," \u2013 Tw\xf3j Tenant ID"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"AZURE_SUBSCRIPTION_ID"})," \u2013 ID subskrypcji, do kt\xf3rej nada\u0142e\u015b uprawnienia (w naszym przypadku Contributor)"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Konfiguracja sekret\xf3w w ustawieniach repozytorium GitHub",src:n(14338).A+"",width:"2668",height:"1610"})}),"\n",(0,r.jsx)(i.h3,{id:"6-testowy-pipeline",children:"6. Testowy Pipeline"}),"\n",(0,r.jsx)(i.p,{children:"Je\u015bli wszystko jest skonfigurowane, mo\u017cemy utworzy\u0107 testowy workflow, aby sprawdzi\u0107 po\u0142\u0105czenie."}),"\n",(0,r.jsxs)(i.p,{children:["Utw\xf3rz plik ",(0,r.jsx)(i.code,{children:".github/workflows/github-actions-test-oidc-federation.yml"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-yaml",children:"name: 'github-actions-test-oidc-federation'\n\non:\n  pull_request:\n    paths:\n      - '.github/workflows/github-actions-test-oidc-federation.yml'\n  push:\n    branches:\n      - main\n    paths:\n      - '.github/workflows/github-actions-test-oidc-federation.yml'\n  workflow_dispatch:\n\npermissions:\n  id-token: write # Wymagane do dzia\u0142ania OIDC!\n  contents: read\n\njobs:\n  azure-login-test:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n\n      - name: Azure Login\n        uses: azure/login@v2\n        with:\n          client-id: ${{ secrets.AZURE_CLIENT_ID }}\n          tenant-id: ${{ secrets.AZURE_TENANT_ID }}\n          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}\n\n      - name: Show Azure Account\n        run: az account show\n\n      - name: List Resource Groups\n        run: az group list --output table\n"})}),"\n",(0,r.jsx)(i.p,{children:"Je\u015bli pipeline zako\u0144czy si\u0119 sukcesem, zobaczysz list\u0119 grup zasob\xf3w w logach."}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Pomy\u015blne wykonanie workflow w GitHub Actions",src:n(73828).A+"",width:"2094",height:"2686"})}),"\n",(0,r.jsx)(i.p,{children:"Je\u015bli pipeline nie dzia\u0142a, upewnij si\u0119, \u017ce:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Sekrety w GitHub s\u0105 poprawne."}),"\n",(0,r.jsx)(i.li,{children:"Rola na subskrypcji zosta\u0142a poprawnie nadana."}),"\n",(0,r.jsxs)(i.li,{children:["Subject w federacji (",(0,r.jsx)(i.code,{children:"repo:U\u017cytkownik/Repo:ref:refs/heads/main"}),") dok\u0142adnie odpowiada Twojemu repozytorium i ga\u0142\u0119zi."]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"przydatne-linki",children:"Przydatne linki"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Azure:"})," ",(0,r.jsx)(i.a,{href:"https://learn.microsoft.com/entra/workload-id/workload-identity-federation-create-trust?WT.mc_id=AZ-MVP-5002690",children:"Configure a federated identity credential"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"GitHub:"})," ",(0,r.jsx)(i.a,{href:"https://docs.github.com/en/actions/concepts/security/openid-connect",children:"OIDC for Actions"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"GitHub Action:"})," ",(0,r.jsx)(i.a,{href:"https://github.com/marketplace/actions/azure-login",children:"Azure Login"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"RBAC:"})," ",(0,r.jsx)(i.a,{href:"https://learn.microsoft.com/azure/role-based-access-control/built-in-roles/privileged?WT.mc_id=AZ-MVP-5002690#contributor",children:"Built-in roles (Contributor)"})]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"Je\u015bli interesuje Ci\u0119 wdro\u017cenie konkretnych us\u0142ug lub masz pytania, daj zna\u0107 w komentarzu!"})]})}function u(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);