<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="JustCloud Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="JustCloud Blog Atom Feed"><title data-react-helmet="true">Jak wdrożyć Azure Pipelines agenta? (How to deploy Azure Pipelines agent?) | JustCloud Blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blog.justcloud.pl/how to deploy azure pipelines agent"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="JustCloud the best quality of knowledge" content="azure, aws, gcp, devops, automation, azure devops, blog, microsoft, linux, azure policy, cloud transformation, digital transformation, governance, security, pipelines, github"><meta data-react-helmet="true" property="og:title" content="Jak wdrożyć Azure Pipelines agenta? (How to deploy Azure Pipelines agent?) | JustCloud Blog"><meta data-react-helmet="true" name="description" content="Potrzebujesz stworzyć własny serwer z agentem do deploymentów w Azure DevOps? W tym artykule opisałem cały proces oraz skrypty umożliwiające bardzo szybkie wdrożenie."><meta data-react-helmet="true" property="og:description" content="Potrzebujesz stworzyć własny serwer z agentem do deploymentów w Azure DevOps? W tym artykule opisałem cały proces oraz skrypty umożliwiające bardzo szybkie wdrożenie."><meta data-react-helmet="true" name="keywords" content="azure,devops,agent,pipelines"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-01-31T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/RogalaPiotr"><meta data-react-helmet="true" property="article:tag" content="deploy,azure,devops,agent,agents,pipelines"><link data-react-helmet="true" rel="icon" href="https://raw.githubusercontent.com/RogalaPiotr/JustCloudWeb/gh-pages/assets/images/favicon-new-1.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.justcloud.pl/how to deploy azure pipelines agent"><link data-react-helmet="true" rel="alternate" href="https://blog.justcloud.pl/how to deploy azure pipelines agent" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.justcloud.pl/how to deploy azure pipelines agent" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.753318a1.css">
<link rel="preload" href="/assets/js/runtime~main.8beb8048.js" as="script">
<link rel="preload" href="/assets/js/main.7a5b0790.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="JustCloud.pl" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="JustCloud.pl" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">JustCloud.pl</b></a></div><div class="navbar__items navbar__items--right"><a href="https://justcloud.pl/index.html#form5-28" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Contact<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/RogalaPiotr/justcloudpublic" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/how to deploy azure pipelines agent">Jak wdrożyć Azure Pipelines agenta? (How to deploy Azure Pipelines agent?)</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/welcome">Nowa odsłona</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/tags-in-azure">Przyspieszenie pracy nad tagowaniem zasobów za pomocą PowerShell - Tag raport Microsoft Azure</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/wyslanie-zadania-api-z-powershell-do-azure-devops">Wysłanie żądania API z PowerShell do Azure DevOps</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/iac-control-via-powershell-module-for-arm-templates">IaC control via PowerShell module for ARM templates</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/skad-uczyc-sie-o-microsoft-azure">Skąd uczyć się o Microsoft Azure?</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/auto-deployment-vm-with-vsts-agent-for-pool">Auto deployment VM with VSTS agent for pool</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/google-cloud-platform-deployment-vm-z-ubuntu">Google Cloud Platform deployment VM z Ubuntu</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/delete-vm-and-create-again-based-on-vhd">Delete VM and create again based on .vhd</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/deployment-maszyny-z-funkcja-auto-shutdown-za-pomoca-szablonu-arm">Deployment maszyny z funkcją Auto-Shutdown  za pomocą szablonu arm</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/profil-logowania-do-azure">Profil logowania do Azure</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/visual-studio-code-i-git-zamiast-powershell-ise">Visual Studio Code i Git zamiast PowerShell ISE - UPDATED</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/grupa-specjalistow-cloudpoland-na-slacku">Grupa specjalistów CloudPoland na Slack&#x27;u</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/tworzenie-szablonu-arm-visual-studio-2017">Tworzenie szablonu ARM - Visual Studio 2017</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/azure-resource-manager-json-automation">Azure Resource Manager - JSON Automation</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">Jak wdrożyć Azure Pipelines agenta? (How to deploy Azure Pipelines agent?)</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-01-31T00:00:00.000Z" itemprop="datePublished">January 31, 2022</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a href="https://github.com/RogalaPiotr" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/31566956?v=4" alt="Piotr Rogala"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/RogalaPiotr" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Piotr Rogala</span></a></div><small class="avatar__subtitle" itemprop="description">MVP Azure &amp; owner JustCloud.pl</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Azure DevOps pozwala na wdrażanie rozwiązań za pośrednictwem agentów tak zwanych <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops&amp;tabs=browser#microsoft-hosted-agents" target="_blank" rel="noopener noreferrer">&quot;Microsoft-hosted&quot;</a> przez 1800 minut (30 godzin) na miesiąc. W momencie przekroczenia tego czasu nie możemy wykonywać deployment&#x27;ów. Jedyna opcja to dokupić unlimited access do agenta za $40 na miesiąc minuty albo korzystać ze swojego serwera, laptopa po zainstalowaniu agenta - ta opcja wdrażania zwana jest w dokumentacji <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops&amp;tabs=browser#install" target="_blank" rel="noopener noreferrer">&quot;Self-Hosted&quot;</a>. Dodam tylko, że wykorzystywania własnego laptopa do wdrażania nie jest rozwiązaniem produkcyjnym 🙃.</p><p>Pricing page Azure DevOps: <a href="https://azure.microsoft.com/en-us/pricing/details/devops/azure-devops-services/" target="_blank" rel="noopener noreferrer">https://azure.microsoft.com/en-us/pricing/details/devops/azure-devops-services/</a></p><p>Bardzo często słyszę pytanie, a po co mi własny serwer do wdrażania?</p><p><a href="https://www.youtube.com/watch?v=OO3FANjwKHY" target="_blank" rel="noopener noreferrer"><img src="https://img.youtube.com/vi/OO3FANjwKHY/0.jpg"></a></p><p>Klasyczna odpowiedź: to zależy... Robiąc prace dyplomową na uczelnie albo projekt PoC dla znajomego, możecie wybrać opcje postawienia agenta na swoim laptopie. Jeśli pracujecie w grupie paru osób najlepiej byłoby skorzystać z własnego serwera. Jeśli jesteście firmą i dostarczacie rozwiązania to napewno powinniście rozważyć własny serwer lub dokupienie &quot;Microsoft-hosted&quot; za $40 - jeśli czas wdrażania przekracza 1800 minut na miesiąc.
Ale jest jeszcze jedna sytuacja kiedy wybierzecie własny serwer z agentami. Wiele firm korzysta z prywatnych kontrolowanych wewnętrznych sieci z ograniczonym dostępem z zewnątrz. Wdrożenie własnego serwera w waszej sieci pozwoli wam na łatwą komunikacje z wdrożonymi rozwiązaniami na platformie Microsoft Azure, ale zwiększycie też bezpieczeństwo procesowanych danych. Pamiętajmy że agent <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops&amp;tabs=browser#microsoft-hosted-agents" target="_blank" rel="noopener noreferrer">&quot;Microsoft-hosted&quot;</a> to agent &quot;publiczny&quot; odizolowany od waszej sieci. <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops&amp;tabs=browser#install" target="_blank" rel="noopener noreferrer">&quot;Self-Hosted&quot;</a> może zostać wdrożony tak samo jako agent odizolowany, ale też możecie go połączyć lub wdrożyć we własnej sieci.</p><p>Poniżej odsyłam was do dokumentacji gdzie możecie szczegółowo dowiedzieć się co Microsoft oferuje w kwestii Azure Pipelines agent.</p><p><a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops&amp;tabs=browser" target="_blank" rel="noopener noreferrer">MS Docs - Azure Pipelines agents</a></p><p><img src="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/media/agent-connections-devops.png?view=azure-devops" alt="Communication to deploy to target servers
"></p><p>Przechodzimy zatem do wdrożenia własnego serwera z agentem.</p><p>Przygotowałem ilustracje związaną z całym projektem dla wdrożenia Azure Pipelines agent w oparciu o ten post oraz potrzebne materiały do jego wdrożenia.</p><p><img alt="steps" src="/assets/images/image1-3a6b83b3327d3fd6856c50caffe8972a.jpg" width="2384" height="1677"></p><ol><li>Linki - za pomocą tych linków macie dostęp do mojego przykładowego wdrożenia</li></ol><ul><li>Azure Repos: <a href="https://dev.azure.com/justcloudpublic/_git/How%20to%20deploy%20ADO%20agent?path=/vm-azure-devops-self-hosted-agents" target="_blank" rel="noopener noreferrer">https://dev.azure.com/justcloudpublic/_git/How%20to%20deploy%20ADO%20agent?path=/vm-azure-devops-self-hosted-agents</a></li><li>Azure Pipeline: <a href="https://dev.azure.com/justcloudpublic/How%20to%20deploy%20ADO%20agent/_build?definitionId=2" target="_blank" rel="noopener noreferrer">https://dev.azure.com/justcloudpublic/How%20to%20deploy%20ADO%20agent/_build?definitionId=2</a></li></ul><p><a href="https://dev.azure.com/justcloudpublic/How%20to%20deploy%20ADO%20agent/_build/latest?definitionId=2&amp;branchName=main" target="_blank" rel="noopener noreferrer"><img src="https://dev.azure.com/justcloudpublic/How%20to%20deploy%20ADO%20agent/_apis/build/status/vm-azure-devops-self-hosted-agents?branchName=main" alt="Build Status"></a></p><ol><li><p>Scripts</p><ol><li><p>Parametry</p><ol><li><p><a href="https://dev.azure.com/justcloudpublic/_git/How%20to%20deploy%20ADO%20agent?path=/vm-azure-devops-self-hosted-agents/scripts/azuredeploy.param.json&amp;version=GBmain&amp;_a=contents" target="_blank" rel="noopener noreferrer">azuredeploy.param.json</a> - te parametry możesz przerobi lub zmienić tak, aby odpowiadały temu co zostanie wdrożone. Ważne - te dane testów są nadpisywane podczas deployment&#x27;u - sprawdź to w pliku: <a href="https://dev.azure.com/justcloudpublic/_git/How%20to%20deploy%20ADO%20agent?path=/vm-azure-devops-self-hosted-agents/pipelines/vm-azure-devops-self-hosted-agents-ci.yml&amp;version=GBmain&amp;_a=contents" target="_blank" rel="noopener noreferrer">vm-azure-devops-self-hosted-agents-ci.yml</a> &quot;overrideParameters&quot;.</p><ol><li>Opis zmiennych<ol><li>adminUsername <!-- -->[User name]</li><li>adminPassword <!-- -->[Password for user]</li><li>dnsLabelPrefix (default set: generated based on ResourceGroup.Id) <!-- -->[Public DNS for connection RDP]</li><li>vmName <!-- -->[VM Name for resource]</li><li>AccessIPNSG <!-- -->[IP will be added to NSG rule for RDP access]</li><li>tag <!-- -->[default set: &quot;Project: AzureDevOpsAgent&quot;]</li><li>DiskForVM <!-- -->[StorageAccount or Managed - choose disk for deployment VM]</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;parameters&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;adminUsername&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;test-user&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;adminPassword&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;test-P@ssw0rd12345&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;vmName&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;ado-agents&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;AccessIPNSG&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;192.168.1.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;tag&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;AzureDevOpsAgent&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;DiskForVM&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;StorageAccount&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li><li><p><a href="https://dev.azure.com/justcloudpublic/_git/How%20to%20deploy%20ADO%20agent?path=/vm-azure-devops-self-hosted-agents/scripts/createresourcegroup-adoagent.param.json&amp;version=GBmain&amp;_a=contents" target="_blank" rel="noopener noreferrer">createresourcegroup-adoagent.param.json</a> - parametry definiują resource groupę.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;parameters&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ResourceGroupLocation&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;westeurope&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ResourceGroupName&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;vm-azure-devops-self-hosted-agents&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;tag&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;key1&quot;: &quot;Project&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;value1&quot;: &quot;AzureDevOpsAgent&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><a href="https://dev.azure.com/justcloudpublic/_git/How%20to%20deploy%20ADO%20agent?path=/vm-azure-devops-self-hosted-agents/scripts/script-post-configuration.ps1&amp;version=GBmain&amp;_a=contents" target="_blank" rel="noopener noreferrer">script-post-configuration.ps1</a> - skrypt odpowiada za instalację agenta oraz przygotowanie potrzebnych paczek. Jeśli potrzebujesz doinstalować dodatkowe paczki dadaj je w sekcji: # Install Packages - najprościej jest skorzysta z paczek choco: <a href="https://docs.chocolatey.org/en-us/choco/commands/list" target="_blank" rel="noopener noreferrer">https://docs.chocolatey.org/en-us/choco/commands/list</a></p><ol><li><p>Opis zmiennych</p><ol><li>urlProjectADO <!-- -->[URL for your ADO project]</li><li>auth (default set: PAT) <!-- -->[Authentication method for your ADO]</li><li>token <!-- -->[Security token for your ADO]</li><li>pool (default set: default) <!-- -->[Pool name for agent in ADO]</li><li>agentname <!-- -->[default is same as VM name]</li><li>numberagents <!-- -->[default is 1 - you can deploy from 1 to 20 agent on one server]</li><li>instalAddtionalPackages <!-- -->[default is $true and is installing all what is needed for simple deployment to Azure - if you need .NET etc. please add manually]</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">param(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Parameter(Mandatory = $true)][string] $urlProjectADO,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Parameter(Mandatory = $false)][string] $auth = &quot;pat&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Parameter(Mandatory = $true)][string] $token,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Parameter(Mandatory = $false)][string] $pool,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Parameter(Mandatory = $false)][string] $agentname,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Parameter(Mandatory = $false)][ValidateRange(1, 20)][int] $numberagents = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Parameter(Mandatory = $false)][bool] $instalAddtionalPackages = $true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">begin {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!(Test-Path &quot;c:\temp&quot;)) { $null = mkdir &quot;c:\temp&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $log | % {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Install Additional Packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($instalAddtionalPackages) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    # Install Packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Install-PackageProvider -Name &quot;Nuget&quot; -Force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    # FIX: WARNING: Not setting tab completion: Profile file does not exist at &#x27;C:\Users\USER\Documents\WindowsPowerShell\Microsoft.PowerShellISE_profile.ps1&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (!(Test-Path -Path $PROFILE)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        New-Item -ItemType File -Path $PROFILE -Force</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString(&#x27;https://chocolatey.org/install.ps1&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    choco feature enable -n allowGlobalConfirmation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    choco install -y powershell-core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Start-Sleep 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    choco install -y azure-cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Start-Sleep 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    choco install -y az.powershell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Start-Sleep 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    choco install -y azcopy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Start-Sleep 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    choco install -y iiscrypto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Start-Sleep 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    #Install AzureRM in Powershell 5.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe -Command &quot;Install-Module -Name AzureRM -AllowClobber -Force -Confirm:`$false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    # END Install Packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                catch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    throw $_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    break</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Get latest version install agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $getLatestVersion = Invoke-WebRequest https://api.github.com/repos/Microsoft/azure-pipelines-agent/releases/latest -UseBasicParsing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $tag = ($getLatestVersion | ConvertFrom-Json)[0].tag_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $tag = $tag.Substring(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $downloadInstallURL = &quot;https://vstsagentpackage.azureedge.net/agent/$tag/vsts-agent-win-x64-$tag.zip&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Creating Pool in Azure DevOps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $encodedPat = [System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes( &quot;:$token&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $body = &quot;{name:`&quot;$pool`&quot;, autoProvision: `&quot;true`&quot;}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!($pool -match &quot;default&quot; -or $pool -match &quot;Azure Pipelines&quot; -or $((Invoke-WebRequest -Method GET -Uri &quot;$urlProjectADO/_apis/distributedtask/pools?api-version=5.1&quot; -UseBasicParsing -Headers @{Authorization = &quot;Basic $encodedPat&quot; }).content | ? { $_ -like &quot;*$pool*&quot; }))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $tmp = $(Invoke-WebRequest -Method POST -Uri &quot;$urlProjectADO/_apis/distributedtask/pools?api-version=5.0-preview.1&quot; -UseBasicParsing -Headers @{Authorization = &quot;Basic $encodedPat&quot; } -Body $body -ContentType &quot;application/json&quot;) 2&gt;$null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Install agenets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $filename = $urlProjectADO.Split(&#x27;/&#x27;)[-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!(Test-Path &quot;c:\temp\$filename&quot;)) { Invoke-WebRequest -Uri $downloadInstallURL -OutFile &quot;c:\temp\$filename&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for ($i = 1; $i -le $numberagents; $i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (!(Test-Path &quot;c:\agent-$i&quot;)) { mkdir &quot;c:\agent-$i&quot; }else { rm c:\agent-$i -recurse -force; mkdir &quot;c:\agent-$i&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Add-Type -AssemblyName System.IO.Compression.FileSystem ; [System.IO.Compression.ZipFile]::ExtractToDirectory(&quot;c:\temp\$filename&quot;, &quot;c:\agent-$i&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .&quot;c:\agent-$i\config.cmd&quot; --unattended --url $urlProjectADO --auth $auth --token $token --pool $pool --agent &quot;$agentname-$i&quot; --runAsService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } | Out-File &quot;c:\temp\ADOagent-$((Get-Date).ToString(&quot;s&quot;).Replace(&quot;:&quot;,&quot;-&quot;)).log&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Remove-Item -Recurse -Force c:\temp -Exclude *.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw $_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        break</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Verbose &quot;Successfully installed Azure DevOps Job Agents&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li></ol></li><li><p>Pipelines</p><ol><li><a href="https://dev.azure.com/justcloudpublic/_git/How%20to%20deploy%20ADO%20agent?path=/vm-azure-devops-self-hosted-agents/pipelines/vm-azure-devops-self-hosted-agents-ci.yml&amp;version=GBmain&amp;_a=contents" target="_blank" rel="noopener noreferrer">vm-azure-devops-self-hosted-agents-ci.yml</a> - w tym pliku zdefiniuj dokładnie dane potrzebne do instalacji agentów - adres Twojego projektu ADO, nazwę pool, ilość agentów. Group oznacza grupę Library w Azure DevOps gdzie przekazujemy bezpiecznie poufne dane.<div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">variables:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: SPNName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: &#x27;Subscription-JustCloudPublic&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* name: location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: &#x27;westeurope&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* name: urlProjectADO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: &#x27;https://justcloudpublic.visualstudio.com&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* name: pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: &#x27;Default&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* name: numberagents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* group: &#x27;justcloudpublickeyvault&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li><li><p>Requirements - potrzebujesz zanim zaczniesz wdrażać</p><ol><li>Azure Subskrypcja</li><li>PAT - Personal Access Token - <a href="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&amp;tabs=Windows#create-a-pat" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&amp;tabs=Windows#create-a-pat</a></li><li>Key Vault - <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/release/azure-key-vault?view=azure-devops" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/devops/pipelines/release/azure-key-vault?view=azure-devops</a></li></ol></li></ol></li></ol><p>Po wdrożeniu:</p><ol><li>Azure DevOps agents
<img src="/assets/images/2022-02-26_20-11-11-8336992a7ceb667eb0794480828457e2.jpg" width="1920" height="553"></li><li>Azure Portal
<img src="/assets/images/2022-02-27_21-35-04-e358992489d465be62c5d0c4e66934de.jpg" width="2240" height="1394"></li></ol><p>Jeśli masz jakieś pytania zapraszam do komentowania 🙂.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/deploy">deploy</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/azure">azure</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/devops">devops</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/agent">agent</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/agents">agents</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/pipelines">pipelines</a></li></ul></div></footer></article><div id="disqus_thread"></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/welcome"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Nowa odsłona</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">JustCloud links</div><ul class="footer__items"><li class="footer__item"><a href="https://justcloud.pl" target="_blank" rel="noopener noreferrer" class="footer__link-item">Web: JustCloud.pl</a></li><li class="footer__item"><a href="https://web.justcloud.pl/index.html#form5-28" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li><li class="footer__item"><a href="https://github.com/RogalaPiotr/justcloudpublic" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://dev.azure.com/justcloudpublic" target="_blank" rel="noopener noreferrer" class="footer__link-item">Azure DevOps</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://azurepoland.pl/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Azure Poland<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.meetup.com/Microsoft-Azure-Users-Group-Poland/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Meetup MAUGP<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/">Blog</a></li><li class="footer__item"><a href="https://www.subscribepage.com/wroclaw-newsletter-workshops" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Newsletter Workshops<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/RogalaPiotr/Presentations" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Prezentacje<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Stay in touch!</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/RogalaPiotr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://pl.linkedin.com/in/rogalapiotr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://piotr-rogala.medium.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.justcloud.pl/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS Feed<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 JustCloud.pl, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8beb8048.js"></script>
<script src="/assets/js/main.7a5b0790.js"></script>
</body>
</html>